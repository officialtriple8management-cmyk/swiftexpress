<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SwiftExpress — Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#141414;
  --sidebar:#1a1a1a;
  --panel:#1e1e1e;
  --card:#242424;
  --border:#2d2d2d;
  --border2:#383838;
  --green:#2ecc71;
  --green-btn:#1db954;
  --green-dark:#17a045;
  --red:#e74c3c;
  --blue:#3b82f6;
  --gray:#888;
  --gray2:#555;
  --white:#e8e8e8;
  --white2:#c0c0c0;
}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--white);font-family:'Inter',sans-serif;font-size:14px;}
.app{opacity:0;transition:opacity 0.4s ease;}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ LAYOUT ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.app{display:flex;height:100vh;overflow:hidden;}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ SIDEBAR ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.sidebar{
  width:210px;flex-shrink:0;
  background:var(--sidebar);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  height:100vh;overflow-y:auto;
  padding:16px 0;
}
.sb-logo{
  display:flex;align-items:center;gap:10px;
  padding:4px 18px 20px;
}
.sb-logo-box{
  width:30px;height:30px;background:#fff;border-radius:6px;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.sb-logo-box svg{width:16px;height:16px;}
.sb-logo-text{font-size:13px;font-weight:600;color:var(--white);}

.sb-nav{display:flex;flex-direction:column;gap:1px;padding:0 8px;}
.sb-item{
  display:flex;align-items:center;gap:12px;
  padding:10px 12px;border-radius:7px;
  cursor:pointer;color:var(--gray);font-size:13px;font-weight:500;
  transition:all 0.15s;border:none;background:none;width:100%;text-align:left;
}
.sb-item svg{width:15px;height:15px;flex-shrink:0;}
.sb-item:hover{background:rgba(255,255,255,0.05);color:var(--white2);}
.sb-item.active{background:rgba(255,255,255,0.07);color:#fff;}
.sb-item.danger-item{color:#e74c3c !important;}
.sb-item.danger-item:hover{background:rgba(231,76,60,0.08);color:#e74c3c;}

/* ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ MAIN ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
.main{flex:1;display:flex;flex-direction:column;min-width:0;height:100vh;overflow:hidden;}

/* TOPBAR */
.topbar{
  height:50px;flex-shrink:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;
  border-bottom:1px solid var(--border);
  background:var(--sidebar);
}
.topbar-left{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:500;}
.topbar-left svg{width:15px;height:15px;color:var(--gray);}
.topbar-right{display:flex;align-items:center;gap:10px;}
.tb-bell{
  width:32px;height:32px;border-radius:7px;
  background:var(--card);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--gray);
  transition:all 0.15s;position:relative;
}
.tb-bell:hover{color:var(--white);}
.tb-bell svg{width:14px;height:14px;}
.tb-avatar{
  width:32px;height:32px;border-radius:50%;
  background:linear-gradient(135deg,#3b82f6,#06b6d4);
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;cursor:pointer;color:#fff;
}

/* SCROLLABLE CONTENT */
.content-area{flex:1;overflow-y:auto;overflow-x:hidden;}

/* ━━━━━━━━━━━━━━━━━━━━━━━━ PAGE SYSTEM ━━━━━━━━━━━━━━━━━━━━━━━━ */
.page{display:none;}
.page.active{display:block;}

/* ━━━━━━━━━━━━━━━━━━━━━━━━ DASHBOARD PAGE ━━━━━━━━━━━━━━━━━━━━━━━━ */

/* TRADINGVIEW TICKER TAPE (real embed) */
.tv-ticker{height:56px;flex-shrink:0;border-bottom:1px solid var(--border);}
.tv-ticker iframe{width:100%;height:100%;border:none;display:block;}

/* 2-col layout: left scrollable, right fixed */
.dash-body{
  display:grid;
  grid-template-columns:1fr 390px;
  min-height:calc(100vh - 50px - 56px);
}

/* LEFT COLUMN */
.dash-left{
  padding:20px;
  border-right:1px solid var(--border);
  overflow-y:auto;
}

/* Balance card */
.balance-card{
  background:transparent;
  padding:4px 0 16px;
  margin-bottom:16px;
}
.balance-top{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:10px;
}
.balance-top-left{display:flex;align-items:center;gap:10px;}
.balance-icon{
  width:28px;height:28px;border-radius:50%;
  background:radial-gradient(circle,#555,#333);
  display:flex;align-items:center;justify-content:center;font-size:11px;
}
.balance-lbl{color:var(--gray);font-size:13px;font-weight:500;}
.dots-btn{
  display:flex;gap:3px;cursor:pointer;padding:4px;
  background:none;border:none;
}
.dots-btn span{width:4px;height:4px;border-radius:50%;background:var(--gray);display:block;}
.balance-amount{
  font-size:32px;font-weight:700;letter-spacing:-0.5px;
  color:#fff;margin-bottom:8px;
  font-variant-numeric:tabular-nums;
}
.balance-badge{
  display:inline-flex;align-items:center;gap:4px;
  background:#1a3d2b;color:var(--green);
  border-radius:20px;padding:3px 10px;font-size:12px;font-weight:600;
}
.balance-badge svg{width:10px;height:10px;}
.bal-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:16px;}
.bal-stat-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:8px;padding:10px 12px;cursor:default;
  transition:border 0.15s;
}
.bal-stat-card:hover{border-color:var(--border2);}
.bal-stat-lbl{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;}
.bal-stat-val{font-size:13px;font-weight:700;color:var(--white);font-variant-numeric:tabular-nums;}
.bal-stat-val.green{color:var(--green);}
.bal-stat-val.blue{color:var(--blue);}

/* PROMO BANNER */
.promo{
  background:linear-gradient(135deg,#c0392b 0%,#9b2c7e 40%,#6c1fa8 100%);
  border-radius:10px;padding:18px 20px;margin-bottom:22px;
}
.promo h3{font-size:15px;font-weight:700;margin-bottom:5px;color:#fff;}
.promo p{font-size:12px;color:rgba(255,255,255,0.8);line-height:1.5;margin-bottom:14px;}
.promo-btns{display:flex;gap:10px;}
.promo-btn-white{
  background:#fff;color:#111;border:none;
  padding:8px 18px;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;
  transition:all 0.15s;
}
.promo-btn-white:hover{background:#f0f0f0;}
.promo-btn-ghost{
  background:rgba(255,255,255,0.15);color:#fff;border:none;
  padding:8px 18px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;
  transition:all 0.15s;
}
.promo-btn-ghost:hover{background:rgba(255,255,255,0.25);}

/* BUY / SELL / CONVERT tabs */
.bsc-row{display:flex;align-items:center;gap:0;margin-bottom:18px;}
.bsc-btn{
  padding:9px 28px;font-size:13px;font-weight:600;cursor:pointer;
  border:none;background:transparent;color:var(--gray);border-radius:7px;
  transition:all 0.15s;
}
.bsc-btn.active-buy{background:var(--green-btn);color:#fff;border-radius:7px;}
.bsc-btn.active-sell{background:var(--red);color:#fff;border-radius:7px;}

/* Trade form */
.t-label{font-size:12px;color:var(--gray);margin-bottom:6px;display:block;}
.t-select{
  width:100%;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:10px 12px;border-radius:7px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;
  transition:border 0.15s;margin-bottom:14px;
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:calc(100% - 12px) center;
  padding-right:36px;
}
.t-select:focus{border-color:var(--green-btn);}
.t-select option{background:#1e1e1e;}

.amount-wrap{position:relative;margin-bottom:6px;}
.t-input{
  width:100%;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:10px 100px 10px 12px;border-radius:7px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;transition:border 0.15s;
}
.t-input:focus{border-color:var(--green-btn);}
.t-input::placeholder{color:var(--gray2);}
.amount-asset{
  position:absolute;right:8px;top:50%;transform:translateY(-50%);
  display:flex;align-items:center;gap:5px;cursor:pointer;
  background:var(--border2);padding:4px 8px;border-radius:5px;
  font-size:12px;font-weight:600;color:var(--white2);
}
.amount-asset svg{width:9px;height:9px;color:var(--gray);}
.current-bal{font-size:12px;color:var(--gray);margin-bottom:14px;}
.current-bal span{color:var(--green);font-weight:600;}

.sltp-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.sltp-col label{font-size:12px;color:var(--gray);display:block;margin-bottom:5px;}
.sltp-input-wrap{position:relative;}
.sltp-input{
  width:100%;background:var(--card);border:1px solid var(--border2);
  color:var(--gray2);padding:9px 42px 9px 10px;border-radius:7px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;
}
.sltp-badge{
  position:absolute;right:8px;top:50%;transform:translateY(-50%);
  font-size:11px;color:var(--gray);font-weight:600;
}

.lev-label{font-size:12px;color:var(--gray);margin-bottom:6px;}
.lev-row{display:flex;gap:8px;margin-bottom:14px;}
.lev-input{
  flex:1;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:9px 10px;border-radius:7px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;
}
.lev-input::placeholder{color:var(--gray2);}
.lev-chip{
  background:var(--card);border:1px solid var(--border2);
  padding:9px 12px;border-radius:7px;font-size:12px;font-weight:600;
  cursor:pointer;color:var(--gray);transition:all 0.15s;
}
.lev-chip:hover{border-color:var(--green-btn);color:var(--green);}
.lev-chip.picked{border-color:var(--green-btn);color:var(--green);background:rgba(46,204,113,0.06);}

.action-btn{
  width:100%;padding:12px;border-radius:8px;border:none;
  font-size:14px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;
  transition:all 0.15s;letter-spacing:0.2px;margin-top:2px;
}
.action-btn.buy{background:var(--green-btn);color:#fff;}
.action-btn.buy:hover{background:var(--green-dark);}
.action-btn.sell-mode{background:var(--red);color:#fff;}
.action-btn.sell-mode:hover{background:#c0392b;}

/* TRADES SECTION */
.trades-wrap{margin-top:22px;}
.trades-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.trades-word{font-size:14px;font-weight:600;color:var(--white);}
.trades-tab{
  padding:5px 14px;border-radius:5px;font-size:12px;font-weight:600;cursor:pointer;
  border:none;background:transparent;color:var(--gray);transition:all 0.15s;
}
.trades-tab.active{background:var(--blue);color:#fff;}
.trades-search-row{display:flex;gap:8px;margin-bottom:12px;}
.trades-search{
  flex:1;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:8px 12px 8px 32px;border-radius:7px;
  font-size:12px;font-family:'Inter',sans-serif;outline:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:10px center;
}
.trades-filter{
  background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:8px 28px 8px 10px;border-radius:7px;
  font-size:12px;font-family:'Inter',sans-serif;outline:none;
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:calc(100% - 8px) center;
}
table{width:100%;border-collapse:collapse;}
thead th{
  font-size:11px;font-weight:600;color:var(--gray);
  padding:8px 10px;text-align:left;
  border-bottom:1px solid var(--border);white-space:nowrap;
}
tbody td{
  padding:10px 10px;font-size:12px;
  border-bottom:1px solid rgba(45,45,45,0.5);color:var(--white2);
}
tbody tr:last-child td{border-bottom:none;}
tbody tr:hover td{background:rgba(255,255,255,0.015);}
.empty-td{text-align:center;color:var(--gray);padding:28px!important;font-size:12px;}

/* RIGHT COLUMN */
.dash-right{
  display:flex;flex-direction:column;
  overflow-y:auto;
  background:var(--sidebar);
}

/* Categories section */
.right-block{
  padding:16px 18px;
  border-bottom:1px solid var(--border);
}
.right-block-title{font-size:13px;font-weight:600;color:var(--white);margin-bottom:5px;}
.right-block-sub{font-size:12px;color:var(--gray);line-height:1.5;}
.right-block-sub a{color:var(--blue);text-decoration:none;font-weight:500;}
.right-block-sub a:hover{text-decoration:underline;}

/* Signal strength */
.sig-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px;}
.sig-lbl{font-size:12px;color:var(--gray);}
.sig-pct{font-size:12px;color:var(--gray);}
.sig-track{height:3px;background:var(--border2);border-radius:2px;overflow:hidden;}
.sig-fill{height:100%;background:linear-gradient(90deg,var(--blue) 0%,var(--green) 100%);border-radius:2px;transition:width 0.6s;}

/* TradingView chart */
.tv-chart{flex-shrink:0;}
.tv-chart iframe{width:100%;border:none;display:block;}

/* Your Top Assets */
.assets-block{padding:14px 18px;flex:1;}
.assets-title{font-size:13px;font-weight:600;color:var(--white);margin-bottom:10px;}
.assets-search-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.assets-search{
  flex:1;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:7px 10px 7px 30px;border-radius:7px;
  font-size:12px;font-family:'Inter',sans-serif;outline:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:9px center;
}
.assets-filter{
  background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:7px 24px 7px 8px;border-radius:7px;
  font-size:12px;font-family:'Inter',sans-serif;outline:none;
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='9' height='9' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:calc(100% - 7px) center;
}
.assets-thead{
  display:grid;grid-template-columns:1fr 100px 60px 70px;
  padding:6px 0 8px;border-bottom:1px solid var(--border);
}
.assets-thead span{font-size:11px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:0.3px;}
.assets-thead span:not(:first-child){text-align:right;}

.asset-row{
  display:grid;grid-template-columns:1fr 100px 60px 70px;
  padding:9px 0;border-bottom:1px solid rgba(45,45,45,0.5);
  align-items:center;
}
.asset-row:last-child{border-bottom:none;}
.asset-info{display:flex;align-items:center;gap:9px;}
.asset-ico{
  width:26px;height:26px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:700;flex-shrink:0;
}
.asset-name{font-size:13px;font-weight:600;color:var(--white);display:flex;align-items:baseline;gap:3px;}
.asset-name small{font-size:10px;color:var(--gray);font-weight:400;}
.asset-amt{font-size:12px;color:var(--white2);text-align:right;font-variant-numeric:tabular-nums;}
.asset-type{font-size:11px;color:var(--gray);text-align:right;}
.asset-val{font-size:12px;font-weight:600;color:var(--white2);text-align:right;font-variant-numeric:tabular-nums;}

/* ━━━━━━━━━━━━━━━━━━━━━━ DEPOSIT / WITHDRAW PAGES ━━━━━━━━━━━━━━━━━━━━━━ */
.inner-wrap{padding:28px;max-width:560px;}
.inner-title{font-size:18px;font-weight:700;margin-bottom:4px;}
.inner-sub{color:var(--gray);font-size:12px;margin-bottom:22px;line-height:1.6;}
.wallet-box{
  background:var(--card);border:1px solid var(--border2);border-left:3px solid var(--green-btn);
  border-radius:8px;padding:14px 16px;margin-bottom:20px;font-size:12px;line-height:1.9;
}
.wallet-box strong{color:var(--green);}
.f-group{margin-bottom:14px;}
.f-group label{display:block;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:var(--gray);margin-bottom:6px;}
.f-group input,.f-group select,.f-group textarea{
  width:100%;background:var(--card);border:1px solid var(--border2);
  color:var(--white);padding:10px 12px;border-radius:7px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;transition:border 0.15s;
}
.f-group input:focus,.f-group select:focus{border-color:var(--green-btn);}
.f-group input::placeholder,.f-group textarea::placeholder{color:var(--gray2);}
.f-group select option{background:#1e1e1e;}
.f-group select{
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:calc(100% - 12px) center;
  padding-right:32px;
}
.avail-bal{
  font-size:24px;font-weight:700;color:var(--green);
  font-variant-numeric:tabular-nums;margin-bottom:18px;
}
.sub-btn{
  width:100%;padding:12px;border-radius:8px;border:none;
  background:var(--green-btn);color:#fff;
  font-size:14px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;
  transition:all 0.15s;
}
.sub-btn:hover{background:var(--green-dark);}
.sub-btn:disabled{opacity:0.5;cursor:not-allowed;}
.msg-box{
  margin-top:12px;padding:11px 14px;border-radius:7px;
  font-size:12px;line-height:1.5;display:none;
}
.msg-box.err{background:rgba(231,76,60,0.08);border:1px solid rgba(231,76,60,0.2);color:#fca5a5;}
.msg-box.ok{background:rgba(46,204,113,0.08);border:1px solid rgba(46,204,113,0.2);color:#6ee7b7;}
.msg-box.show{display:block;}

/* ━━━━━━━━━━━━━━━━━━━━━ OTHER PAGES (Markets, Subscribe etc) ━━━━━━━━━━━━━━━━━━━━━ */
.fullframe-page{height:calc(100vh - 50px);}
.fullframe-page iframe{width:100%;height:100%;border:none;display:block;}

.simple-page{padding:28px;max-width:700px;}
.simple-page h2{font-size:18px;font-weight:700;margin-bottom:6px;}
.simple-page .sub{color:var(--gray);font-size:12px;margin-bottom:22px;}
/* ━━━━━━━━━━━━━━━━━━━━ SUBSCRIBE PAGE ━━━━━━━━━━━━━━━━━━━━ */
.sub-page-wrap{padding:32px 28px;max-width:1100px;}
.sub-page-title{font-size:24px;font-weight:800;color:#fff;margin-bottom:4px;}
.sub-page-sub{font-size:13px;color:var(--gray);margin-bottom:32px;}
.plan-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;}
.plan-card{
  background:#0d1117;border:1px solid #1e2a38;
  border-radius:16px;padding:28px 24px;
  display:flex;flex-direction:column;gap:0;
  position:relative;overflow:hidden;transition:border 0.2s;
}
.plan-card:hover{border-color:#2a3f5f;}
.plan-card.featured{border-color:#3b82f6;box-shadow:0 0 0 1px #3b82f6;}
.plan-badge{
  position:absolute;top:16px;right:-22px;
  background:#3b82f6;color:#fff;
  font-size:9px;font-weight:800;letter-spacing:1px;
  padding:5px 32px;transform:rotate(35deg);text-transform:uppercase;
}
.plan-label{font-size:10px;font-weight:800;letter-spacing:1.5px;color:#3b82f6;text-transform:uppercase;margin-bottom:12px;}
.plan-pct{font-size:56px;font-weight:900;color:#fff;line-height:1;margin-bottom:2px;font-family:'Inter',sans-serif;}
.plan-pct sup{font-size:22px;vertical-align:super;font-weight:700;}
.plan-freq{font-size:13px;color:var(--gray);margin-bottom:20px;}
.plan-minmax{
  background:#111827;border:1px solid #1e2a38;border-radius:8px;
  padding:12px 14px;font-size:12px;margin-bottom:20px;
}
.plan-minmax span{color:#3b82f6;font-weight:700;}
.plan-features{list-style:none;display:flex;flex-direction:column;gap:10px;margin-bottom:28px;flex:1;}
.plan-features li{display:flex;align-items:center;gap:8px;font-size:12px;color:#b0bec5;}
.plan-features li::before{content:'✓';color:#3b82f6;font-weight:800;flex-shrink:0;}
.plan-get-btn{
  width:100%;padding:13px;border-radius:8px;border:none;
  background:#111827;color:#fff;font-size:13px;font-weight:700;
  font-family:'Inter',sans-serif;cursor:pointer;transition:all 0.15s;
  border:1px solid #1e2a38;
}
.plan-get-btn:hover{border-color:#3b82f6;color:#3b82f6;}
.plan-card.featured .plan-get-btn{
  background:#3b82f6;border-color:#3b82f6;color:#fff;
}
.plan-card.featured .plan-get-btn:hover{background:#2563eb;}
@media(max-width:800px){
  .plan-cards{grid-template-columns:1fr;}
  .sub-page-wrap{padding:16px;}
}

.signal-cards{display:flex;flex-direction:column;gap:10px;}
.signal-card{background:var(--card);border:1px solid var(--border2);border-radius:8px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;}
.signal-card-left h4{font-size:13px;font-weight:600;margin-bottom:3px;}
.signal-card-left p{font-size:11px;color:var(--gray);}
.sig-chip{font-size:11px;font-weight:700;padding:4px 10px;border-radius:4px;}
.sig-buy{background:rgba(46,204,113,0.1);color:var(--green);}
.sig-hold{background:rgba(212,160,23,0.1);color:#d4a017;}

.stake-cards{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.stake-card{background:var(--card);border:1px solid var(--border2);border-radius:10px;padding:18px;}
.stake-card-top{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.stake-ico{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;}
.stake-apy{font-size:22px;font-weight:800;color:var(--green);margin-bottom:2px;}
.stake-period{font-size:11px;color:var(--gray);margin-bottom:12px;}
.stake-btn{width:100%;padding:9px;border-radius:7px;border:none;background:var(--green-btn);color:#fff;font-size:12px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;}

/* NOTIFICATIONS PANEL */
.notif-overlay{
  position:fixed;inset:0;z-index:800;display:none;
}
.notif-overlay.open{display:block;}
.notif-panel{
  position:fixed;top:50px;right:0;width:300px;
  background:var(--sidebar);border-left:1px solid var(--border);border-bottom:1px solid var(--border);
  max-height:420px;overflow-y:auto;z-index:900;
  box-shadow:-8px 8px 32px rgba(0,0,0,0.5);
}
.notif-hdr{padding:14px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;}
.notif-item{padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.12s;}
.notif-item:hover{background:var(--card);}
.notif-item.unread{border-left:2px solid var(--blue);}
.notif-item h5{font-size:12px;font-weight:600;margin-bottom:3px;}
.notif-item p{font-size:11px;color:var(--gray);line-height:1.4;}
.notif-empty{padding:28px;text-align:center;color:var(--gray);font-size:12px;}

/* PROFILE DROPDOWN */
.profile-overlay{position:fixed;inset:0;z-index:800;display:none;}
.profile-overlay.open{display:block;}
.profile-panel{
  position:fixed;top:50px;right:0;width:220px;
  background:var(--sidebar);border-left:1px solid var(--border);border-bottom:1px solid var(--border);
  z-index:900;box-shadow:-8px 8px 32px rgba(0,0,0,0.5);
}
.profile-head{padding:14px 16px;border-bottom:1px solid var(--border);}
.profile-head-name{font-size:13px;font-weight:600;margin-bottom:2px;}
.profile-head-email{font-size:11px;color:var(--gray);}
.profile-item{
  display:flex;align-items:center;gap:10px;
  padding:11px 16px;cursor:pointer;color:var(--gray);font-size:12px;transition:all 0.12s;
}
.profile-item:hover{background:var(--card);color:var(--white);}
.profile-item.danger{color:#e74c3c;}

/* CHAT BUBBLE */
.chat-btn{
  position:fixed;bottom:20px;right:20px;
  width:48px;height:48px;border-radius:50%;
  background:var(--blue);color:#fff;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:18px;z-index:700;
  box-shadow:0 4px 16px rgba(59,130,246,0.4);transition:transform 0.15s;
}
.chat-btn:hover{transform:scale(1.08);}
.chat-notif{
  position:absolute;top:-2px;right:-2px;
  width:15px;height:15px;border-radius:50%;
  background:#e74c3c;border:2px solid var(--bg);
  font-size:9px;display:flex;align-items:center;justify-content:center;font-weight:700;
}

@media(max-width:1100px){.dash-right{display:none;}}

/* ━━━━━━━━━━━━━━━━━ MOBILE SIDEBAR OVERLAY ━━━━━━━━━━━━━━━━━ */
.mobile-topbar{
  display:none;height:52px;background:var(--sidebar);
  border-bottom:1px solid var(--border);
  align-items:center;justify-content:space-between;
  padding:0 16px;flex-shrink:0;
}
.mobile-logo{font-size:15px;font-weight:700;color:#fff;}
.mobile-logo span{color:var(--blue);}
.hamburger{
  width:36px;height:36px;border-radius:7px;background:var(--card);
  border:1px solid var(--border);display:flex;align-items:center;
  justify-content:center;cursor:pointer;flex-direction:column;gap:4px;padding:8px;
}
.hamburger span{display:block;width:18px;height:2px;background:var(--white);border-radius:2px;transition:all 0.2s;}
.mob-overlay{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);
  z-index:800;backdrop-filter:blur(2px);
}
.mob-overlay.open{display:block;}
.mob-drawer{
  position:fixed;left:0;top:0;bottom:0;width:260px;
  background:var(--sidebar);border-right:1px solid var(--border);
  z-index:900;transform:translateX(-100%);
  transition:transform 0.25s ease;overflow-y:auto;padding:16px 0;
}
.mob-drawer.open{transform:translateX(0);}
.mob-close{
  position:absolute;top:12px;right:12px;
  width:28px;height:28px;border-radius:6px;
  background:var(--card);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;color:var(--gray);font-size:14px;
}

@media(max-width:800px){
  .sidebar{display:none !important;}
  .mobile-topbar{display:flex;}
  .app{flex-direction:column;}
  .main{height:calc(100vh - 52px);}
  .topbar{padding:0 14px;height:44px;}
  .topbar-title{font-size:13px;}
  .dash-body{grid-template-columns:1fr;}
  .dash-right{display:none;}
  .dash-left{padding:14px;}
  .balance-amount{font-size:26px;}
  .promo{padding:14px 16px;}
  .promo h3{font-size:13px;}
  .promo-btns{flex-direction:column;gap:8px;}
  .promo-btn-white,.promo-btn-ghost{width:100%;text-align:center;}
  .bsc-row{gap:4px;}
  .bsc-btn{padding:8px 16px;font-size:12px;}
  .sltp-grid{grid-template-columns:1fr;}
  .lev-chips{flex-wrap:wrap;}
  .inner-wrap{padding:14px;}
  .inner-title{font-size:16px;}
  .ticker-wrap{display:none;}
  .tv-ticker{display:none;}
  .trades-tbl th,.trades-tbl td{padding:8px 6px;font-size:11px;}
  .page-content-scroll{padding:14px;}
}
@media(max-width:480px){
  .balance-amount{font-size:22px;}

  .bsc-btn{padding:7px 12px;font-size:11px;}
  .t-input,.t-select{font-size:13px;}
  .modal-box{margin:8px;padding:20px;}
}

/* ━━━━━━━━━━━━━━━━━━━━━━━━ DEPOSIT MODAL ━━━━━━━━━━━━━━━━━━━━━━━━ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.75);
  z-index:2000;display:none;align-items:center;justify-content:center;
  backdrop-filter:blur(4px);
}
.modal-overlay.open{display:flex;}
.modal-box{
  background:#1e1e1e;border:1px solid #383838;border-radius:14px;
  padding:28px;width:100%;max-width:480px;margin:16px;
  position:relative;animation:modalIn 0.2s ease;
}
@keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
.modal-close{
  position:absolute;top:16px;right:16px;
  background:none;border:none;color:#888;cursor:pointer;font-size:20px;
  width:28px;height:28px;display:flex;align-items:center;justify-content:center;
  border-radius:4px;transition:all 0.15s;
}
.modal-close:hover{background:#333;color:#fff;}
.modal-title{font-size:18px;font-weight:700;margin-bottom:6px;color:#fff;}
.modal-sub{font-size:12px;color:#888;margin-bottom:20px;line-height:1.5;}
.modal-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:#888;margin-bottom:6px;display:block;}
.modal-select{
  width:100%;background:#242424;border:1px solid #383838;
  color:#e8e8e8;padding:11px 36px 11px 12px;border-radius:8px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;
  appearance:none;margin-bottom:16px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:calc(100% - 12px) center;
  transition:border 0.15s;
}
.modal-select:focus{border-color:#1db954;}
.modal-select option{background:#1e1e1e;}
.address-box{
  display:flex;align-items:center;gap:8px;
  background:#242424;border:1px solid #383838;border-radius:8px;
  padding:10px 12px;margin-bottom:16px;
}
.address-text{
  flex:1;font-size:12px;color:#c0c0c0;word-break:break-all;
  font-family:monospace;line-height:1.4;
}
.copy-btn{
  flex-shrink:0;background:#1db954;color:#fff;border:none;
  padding:7px 14px;border-radius:6px;font-size:12px;font-weight:700;
  cursor:pointer;transition:all 0.15s;white-space:nowrap;
}
.copy-btn:hover{background:#17a045;}
.copy-btn.copied{background:#3b82f6;}
.modal-input{
  width:100%;background:#242424;border:1px solid #383838;
  color:#e8e8e8;padding:11px 12px;border-radius:8px;
  font-size:13px;font-family:'Inter',sans-serif;outline:none;
  transition:border 0.15s;margin-bottom:16px;
}
.modal-input:focus{border-color:#1db954;}
.modal-input::placeholder{color:#555;}
.upload-area{
  border:1px dashed #383838;border-radius:8px;padding:16px;
  text-align:center;cursor:pointer;margin-bottom:16px;
  transition:all 0.15s;background:#1a1a1a;
}
.upload-area:hover{border-color:#1db954;background:#1a2a1a;}
.upload-area input{display:none;}
.upload-label{color:#1db954;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;}
.upload-label svg{width:14px;height:14px;}
.upload-name{font-size:11px;color:#888;margin-top:4px;}
.modal-dep-btn{
  width:100%;padding:13px;border-radius:8px;border:none;
  background:#1db954;color:#fff;font-size:14px;font-weight:700;
  font-family:'Inter',sans-serif;cursor:pointer;transition:all 0.15s;
}
.modal-dep-btn:hover{background:#17a045;}
.modal-dep-btn:disabled{opacity:0.5;cursor:not-allowed;}
.modal-msg{margin-top:12px;padding:10px 12px;border-radius:7px;font-size:12px;display:none;}
.modal-msg.err{background:rgba(231,76,60,0.08);border:1px solid rgba(231,76,60,0.2);color:#fca5a5;display:block;}
.modal-msg.ok{background:rgba(46,204,113,0.08);border:1px solid rgba(46,204,113,0.2);color:#6ee7b7;display:block;}
.no-addr{color:#e74c3c;font-size:12px;font-style:italic;}

/* ── PROFILE DROPDOWN ENHANCED ── */
.profile-panel{width:300px;}
.pi-icon{
  width:34px;height:34px;border-radius:8px;
  background:var(--card);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;color:var(--gray);
}
.pi-title{font-size:13px;font-weight:600;color:var(--white);}
.pi-sub{font-size:11px;color:var(--gray);margin-top:1px;}
.pd-section-label{
  font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--gray2);padding:8px 16px 4px;
}
.profile-item{gap:12px;padding:10px 14px;align-items:center;}

/* ── SETTINGS PANEL ── */
.settings-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.6);
  z-index:1800;display:none;backdrop-filter:blur(3px);
}
.settings-overlay.open{display:block;}
.settings-panel{
  position:fixed;top:0;right:0;bottom:0;width:320px;
  background:var(--sidebar);border-left:1px solid var(--border);
  z-index:1900;transform:translateX(100%);
  transition:transform 0.25s ease;
  display:flex;flex-direction:column;overflow-y:auto;
}
.settings-panel.open{transform:translateX(0);}
.settings-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 20px;border-bottom:1px solid var(--border);
  font-size:16px;font-weight:700;flex-shrink:0;
}
.settings-close{
  width:28px;height:28px;border-radius:6px;background:var(--card);
  border:1px solid var(--border);display:flex;align-items:center;
  justify-content:center;cursor:pointer;color:var(--gray);font-size:14px;
}
.settings-user{
  display:flex;align-items:center;gap:12px;
  padding:16px 20px;border-bottom:1px solid var(--border);
}
.settings-user-avatar{
  width:48px;height:48px;border-radius:50%;
  background:linear-gradient(135deg,#3b82f6,#06b6d4);
  display:flex;align-items:center;justify-content:center;
  font-size:15px;font-weight:700;color:#fff;flex-shrink:0;
}
.settings-user-name{font-size:13px;font-weight:700;}
.settings-user-email{font-size:11px;color:var(--gray);}
.settings-not-verified{
  display:inline-flex;align-items:center;gap:4px;
  color:#e74c3c;font-size:10px;font-weight:700;margin-top:3px;
}
.settings-section-label{
  font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--gray2);padding:14px 20px 6px;
}
.settings-item{
  display:flex;align-items:center;gap:14px;
  padding:13px 20px;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.03);
  transition:background 0.12s;
}
.settings-item:hover{background:var(--card);}
.settings-item-icon{
  width:38px;height:38px;border-radius:9px;
  background:var(--card);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  color:var(--gray);flex-shrink:0;
}
.settings-item-title{font-size:13px;font-weight:600;color:var(--white);}
.settings-item-sub{font-size:11px;color:var(--gray);margin-top:1px;}
@media(max-width:800px){
  .settings-panel{width:100%;}
  .profile-panel{width:280px;}
}

/* ── PROFILE INFO CARDS ── */
.prof-info-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px 16px;}
.prof-info-label{font-size:10px;text-transform:uppercase;letter-spacing:0.8px;color:var(--gray);margin-bottom:4px;}
.prof-info-val{font-size:13px;font-weight:600;color:var(--white);}

/* ── SECURITY CARDS ── */
.sec-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;margin-bottom:16px;}
.sec-card-title{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:700;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.pw-wrap{position:relative;}
.pw-eye{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:13px;padding:0;}
.f-group{margin-bottom:0;}
.f-group label{display:block;font-size:11px;color:var(--gray);margin-bottom:5px;margin-top:12px;}

/* ── TOGGLE SWITCH ── */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.toggle-row:last-child{border-bottom:none;}
.toggle-label{font-size:13px;font-weight:600;}
.toggle-sub{font-size:11px;color:var(--gray);margin-top:2px;}
.sw-toggle{position:relative;display:inline-block;width:42px;height:24px;flex-shrink:0;}
.sw-toggle input{opacity:0;width:0;height:0;}
.sw-slider{position:absolute;cursor:pointer;inset:0;background:var(--border2);border-radius:24px;transition:0.3s;}
.sw-slider:before{content:'';position:absolute;height:18px;width:18px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:0.3s;}
.sw-toggle input:checked + .sw-slider{background:var(--blue);}
.sw-toggle input:checked + .sw-slider:before{transform:translateX(18px);}

/* ── THEME OPTIONS ── */
.theme-opt{transition:border 0.2s;color:var(--white);}
.active-theme{border-color:var(--blue) !important;}

/* ── WALLET OPTIONS ── */
.wallet-opt{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 18px;cursor:pointer;transition:border 0.15s;}
.wallet-opt:hover{border-color:var(--blue);}

/* ── EXPERT CARDS ── */
.expert-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;}
.expert-stat{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;}
.expert-stat-val{font-size:14px;font-weight:800;color:var(--white);}
.expert-stat-lbl{font-size:10px;color:var(--gray);margin-top:2px;}

/* ── KYC DROP ZONE ── */
#kyc-drop-zone:hover{border-color:var(--blue);}

/* ── MOBILE: prof grid 1col ── */
@media(max-width:600px){
  .prof-info-card ~ .prof-info-card:nth-child(2n+1){grid-column:1;} 
  #page-user-profile .inner-wrap > div:nth-child(2){grid-template-columns:1fr !important;}
  #page-personal-info .f-group ~ .f-group{grid-template-columns:1fr !important;}
}

/* ── WATCHLIST FILTER BTNS ── */
.wl-filter-btn{background:var(--card);border:1px solid var(--border);color:var(--gray);padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s;}
.wl-filter-btn.active{background:var(--blue);border-color:var(--blue);color:#fff;}
/* ── PRICE CARD ── */
.price-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:8px;transition:border 0.2s;cursor:default;}
.price-card:hover{border-color:var(--border2);}
.price-card-top{display:flex;align-items:center;justify-content:space-between;}
.price-card-ico{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0;}
.price-card-sym{font-size:13px;font-weight:800;color:var(--white);}
.price-card-name{font-size:10px;color:var(--gray);margin-top:1px;}
.price-card-price{font-size:18px;font-weight:800;font-variant-numeric:tabular-nums;}
.price-card-chg{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:700;padding:3px 8px;border-radius:10px;}
.price-card-chg.up{background:rgba(16,185,129,0.1);color:var(--green);}
.price-card-chg.dn{background:rgba(239,68,68,0.1);color:#ef4444;}
.price-card-bar{height:3px;border-radius:2px;background:var(--border);overflow:hidden;margin-top:4px;}
.price-card-fill{height:100%;border-radius:2px;transition:width 0.8s ease;}
@keyframes spin{to{transform:rotate(360deg)}}

/* ── CURRENT PLAN HIGHLIGHT ── */
.plan-card.current-plan{
  border-color:var(--blue) !important;
  box-shadow:0 0 0 1px rgba(59,130,246,0.3),0 8px 32px rgba(59,130,246,0.15) !important;
  position:relative;
}
.current-plan-chip{
  position:absolute;top:-12px;left:50%;transform:translateX(-50%);
  background:var(--blue);color:#fff;font-size:10px;font-weight:800;
  padding:4px 14px;border-radius:20px;letter-spacing:0.5px;
  white-space:nowrap;z-index:2;
}
.plan-get-btn.current-btn{
  background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);
  color:var(--blue);cursor:default;
}
.plan-get-btn.current-btn:hover{background:rgba(59,130,246,0.1);border-color:rgba(59,130,246,0.3);}

/* ── PAST TIER (user has exceeded this plan) ── */
.plan-card.past-plan{
  opacity:0.45;
  filter:grayscale(0.6);
  pointer-events:none;
  border-color:var(--border) !important;
  box-shadow:none !important;
}
.plan-card.past-plan .plan-pct,
.plan-card.past-plan .plan-label{
  text-decoration:line-through;
  color:var(--gray) !important;
}
.past-plan-chip{
  position:absolute;top:-12px;left:50%;transform:translateX(-50%);
  background:var(--border2);color:var(--gray);font-size:10px;font-weight:800;
  padding:4px 14px;border-radius:20px;letter-spacing:0.5px;
  white-space:nowrap;z-index:2;
}
.plan-get-btn.past-btn{
  background:var(--card) !important;
  border:1px solid var(--border) !important;
  color:var(--gray) !important;
  cursor:not-allowed !important;
  opacity:0.6;
}

/* ── HISTORY PAGE ── */
.hist-filter{background:var(--card);border:1px solid var(--border);color:var(--gray);padding:6px 13px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s;}
.hist-filter:hover{color:var(--white);}
.active-hf{background:var(--blue);border-color:var(--blue);color:#fff !important;}
.hist-sum-card{border:1px solid var(--border);border-radius:10px;padding:14px 16px;}
.hist-tx-row{
  display:flex;align-items:center;gap:14px;
  background:var(--card);border:1px solid var(--border);border-radius:10px;
  padding:14px 16px;transition:border 0.15s;
}
.hist-tx-row:hover{border-color:var(--border2);}
.hist-tx-icon{
  width:38px;height:38px;border-radius:9px;
  display:flex;align-items:center;justify-content:center;
  font-size:16px;flex-shrink:0;
}
.hist-tx-title{font-size:13px;font-weight:700;}
.hist-tx-date{font-size:11px;color:var(--gray);margin-top:2px;}
.hist-tx-amount{margin-left:auto;text-align:right;}
.hist-tx-amt-val{font-size:14px;font-weight:800;}
.hist-tx-status{font-size:10px;font-weight:700;padding:2px 8px;border-radius:8px;margin-top:3px;display:inline-block;}

/* ── NOTIFICATIONS PAGE ── */
.notif-page-item{
  display:flex;align-items:flex-start;gap:14px;
  background:var(--card);border:1px solid var(--border);border-radius:10px;
  padding:14px 16px;transition:border 0.15s;position:relative;
}
.notif-page-item.unread{border-left:3px solid var(--blue);}
.notif-page-dot{
  width:8px;height:8px;border-radius:50%;background:var(--blue);
  position:absolute;top:16px;right:16px;flex-shrink:0;
}
.notif-page-icon{
  width:38px;height:38px;border-radius:9px;background:rgba(59,130,246,0.1);
  display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;
}
.notif-page-title{font-size:13px;font-weight:700;margin-bottom:3px;}
.notif-page-body{font-size:12px;color:var(--gray);line-height:1.5;}
.notif-page-time{font-size:10px;color:var(--gray);margin-top:5px;}

@media(max-width:600px){
  #hist-summary{grid-template-columns:1fr !important;}
}

/* ── REFERRAL STATS ── */
.ref-stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;text-align:center;}
.ref-stat-num{font-size:26px;font-weight:800;color:var(--white);margin-bottom:4px;}
.ref-stat-lbl{font-size:11px;color:var(--gray);font-weight:500;}
/* ── REF LIST ITEMS ── */
.ref-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.ref-item:last-child{border-bottom:none;}
/* ── BLOG CARDS ── */
.blog-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;cursor:pointer;transition:border 0.15s;}
.blog-card:hover{border-color:var(--blue);}
.blog-tag{display:inline-block;padding:3px 10px;border-radius:10px;font-size:10px;font-weight:700;margin-bottom:10px;}
.blog-title{font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px;line-height:1.4;}
.blog-excerpt{font-size:12px;color:var(--gray);line-height:1.6;}
.blog-meta{display:flex;align-items:center;gap:12px;margin-top:12px;font-size:11px;color:var(--gray);}
.blog-expanded{display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);font-size:13px;color:var(--gray);line-height:1.7;}
/* ── HIST SUM CARD ── */
.hist-sum-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px 16px;}
/* ── HIST FILTER ── */
.hist-filter{background:var(--card);border:1px solid var(--border);color:var(--gray);padding:6px 12px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s;}
.hist-filter:hover,.active-hf{background:var(--blue);border-color:var(--blue);color:#fff;}
/* ── NOTIF PAGE ITEMS ── */
.notif-page-item{display:flex;align-items:flex-start;gap:12px;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;}
.notif-page-item.unread{border-left:3px solid var(--blue);}
.notif-page-dot{width:8px;height:8px;border-radius:50%;background:var(--blue);margin-top:4px;flex-shrink:0;}

/* ── HISTORY PAGE ── */
.hist-filter{background:var(--card);border:1px solid var(--border);color:var(--gray);padding:6px 13px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s;}
.hist-filter:hover{color:var(--white);}
.active-hf{background:var(--blue);border-color:var(--blue);color:#fff !important;}
.hist-stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px 16px;}
.hist-stat-val{font-size:18px;font-weight:800;color:var(--white);}
.hist-stat-lbl{font-size:10px;color:var(--gray);margin-top:3px;text-transform:uppercase;letter-spacing:0.5px;}
.hist-row{border-bottom:1px solid rgba(255,255,255,0.04);transition:background 0.12s;}
.hist-row:last-child{border-bottom:none;}
.hist-row:hover{background:rgba(255,255,255,0.02);}
.hist-row td{padding:12px 16px;font-size:12px;}
.hist-badge{display:inline-block;padding:3px 9px;border-radius:10px;font-size:10px;font-weight:700;}
.hb-pending{background:rgba(245,158,11,0.1);color:#f59e0b;}
.hb-approved{background:rgba(16,185,129,0.1);color:var(--green);}
.hb-rejected{background:rgba(239,68,68,0.1);color:#ef4444;}
/* ── NOTIFICATIONS PAGE ── */
.notif-page-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 18px;margin-bottom:10px;display:flex;gap:14px;align-items:flex-start;transition:border 0.15s;}
.notif-page-item.unread-page{border-color:rgba(59,130,246,0.35);background:rgba(59,130,246,0.04);}
.notif-page-item:hover{border-color:var(--border2);}
.notif-dot{width:8px;height:8px;border-radius:50%;background:var(--blue);flex-shrink:0;margin-top:5px;}
.notif-dot.read-dot{background:var(--border2);}
</style>
</head>
<body>
<!-- LOADING SCREEN -->
<div id="loading-screen" style="position:fixed;inset:0;background:#141414;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;">
  <div style="width:36px;height:36px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
  <div style="color:#888;font-size:13px;font-family:Inter,sans-serif;">Loading your dashboard...</div>
  <div style="width:200px;height:3px;background:#2d2d2d;border-radius:2px;overflow:hidden;"><div style="height:100%;background:#3b82f6;border-radius:2px;width:60%;margin-left:20%;animation:ldSl 1.2s ease-in-out infinite;"></div></div>
</div>
<style>@keyframes ldSl{0%{width:0;margin-left:0}50%{width:60%;margin-left:20%}100%{width:0;margin-left:100%}}</style>
<div class="app">

<!-- MOBILE TOP BAR -->
<div class="mobile-topbar" id="mobile-topbar">
  <div class="mobile-logo">Swift<span>Express</span></div>
  <button class="hamburger" onclick="openMobileMenu()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
</div>

<!-- MOBILE OVERLAY + DRAWER -->
<div class="mob-overlay" id="mob-overlay" onclick="closeMobileMenu()"></div>
<div class="mob-drawer" id="mob-drawer">
  <button class="mob-close" onclick="closeMobileMenu()">✕</button>
  <div style="padding:16px 18px 20px;border-bottom:1px solid var(--border);margin-bottom:8px;">
    <div style="font-size:15px;font-weight:700;color:#fff;">Swift<span style="color:var(--blue)">Express</span></div>
    <div style="font-size:11px;color:var(--gray);margin-top:2px;" id="mob-user-email"></div>
  </div>
  <nav class="sb-nav" id="mob-nav">
    <button class="sb-item active" onclick="mobileSwitchPage('dashboard',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>Dashboard</button>
    <button class="sb-item" onclick="openDepositModal();closeMobileMenu()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>Deposit</button>
    <button class="sb-item" onclick="mobileSwitchPage('withdraw',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg>Withdraw</button>
    <button class="sb-item" onclick="mobileSwitchPage('assets',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>Assets</button>
    <button class="sb-item" onclick="mobileSwitchPage('markets',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Markets</button>
    <button class="sb-item" onclick="mobileSwitchPage('trade',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>Trade</button>
    <button class="sb-item" onclick="mobileSwitchPage('subscribe',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>Subscribe</button>
    <button class="sb-item" onclick="mobileSwitchPage('signals',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 6c0 0 4-2 11-2s11 2 11 2"/><path d="M5 10c0 0 3-1 7-1s7 1 7 1"/><path d="M9 14c0 0 1-0.5 3-0.5s3 0.5 3 0.5"/><line x1="12" y1="18" x2="12" y2="18"/></svg>Signals</button>
  </nav>
  <div style="padding:16px 18px;border-top:1px solid var(--border);position:absolute;bottom:0;width:100%;background:var(--sidebar);">
    <button onclick="doLogout()" style="width:100%;background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.2);color:#e74c3c;padding:10px;border-radius:7px;cursor:pointer;font-size:13px;font-family:inherit;">🚪 Logout</button>
  </div>
</div>

  <!-- ══════════════ SIDEBAR ══════════════ -->
  <aside class="sidebar">
    <div class="sb-logo">
      <div class="sb-logo-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      </div>
      <span class="sb-logo-text">SwiftExpress</span>
    </div>
    <nav class="sb-nav">

      <!-- ── MAIN ── -->
      <div class="sb-section-label">Main</div>
      <button class="sb-item active" onclick="switchPage('dashboard',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Dashboard
      </button>
      <button class="sb-item" onclick="switchPage('dashboard',this);setTimeout(openDepositModal,100)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
        Deposit
      </button>
      <button class="sb-item" onclick="switchPage('withdraw',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
        Withdraw
      </button>
      <button class="sb-item" onclick="switchPage('assets',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>
        Assets
      </button>
      <button class="sb-item" onclick="switchPage('history',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        History
      </button>
      <button class="sb-item" onclick="switchPage('notifications-page',this)" id="sb-notif-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        Notifications
      </button>
      <button class="sb-item" onclick="switchPage('referrals',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Referrals
      </button>

      <div class="sb-sep"></div>

      <!-- ── TRADING ACTIONS ── -->
      <div class="sb-section-label">Trading Actions</div>
      <button class="sb-item" onclick="switchPage('trade',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        Trade
      </button>
      <button class="sb-item" onclick="switchPage('markets',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        Watchlist
      </button>
      <button class="sb-item" onclick="switchPage('swap',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
        Swap
      </button>
      <button class="sb-item" onclick="switchPage('stake',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
        Staking
      </button>
      <button class="sb-item" onclick="switchPage('signals',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1"/></svg>
        Signals
      </button>
      <button class="sb-item" onclick="switchPage('blog',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"/><path d="M16 2v4"/><path d="M8 18h8"/><path d="M8 14h8"/><path d="M8 10h4"/></svg>
        News
      </button>

      <div class="sb-sep"></div>

      <!-- ── SETUP ── -->
      <div class="sb-section-label">Setup</div>
      <button class="sb-item" onclick="switchPage('connect-wallet',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Connect Wallet
      </button>
      <button class="sb-item" onclick="switchPage('copy-experts',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copy Experts
      </button>
      <button class="sb-item" onclick="switchPage('subscribe',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><polyline points="8 21 12 17 16 21"/></svg>
        Subscribe
      </button>
      <button class="sb-item" onclick="switchPage('settings',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </button>
      <button class="sb-item danger-item" onclick="doLogout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Log Out
      </button>

    </nav>
  </aside>

  <!-- ══════════════ MAIN ══════════════ -->
  <div class="main">

    <!-- TOPBAR -->
    <!-- MOBILE HAMBURGER -->
  <button id="mobile-menu-btn" onclick="toggleMobileSidebar()" style="display:none;position:fixed;bottom:20px;right:20px;width:52px;height:52px;border-radius:50%;background:#3b82f6;border:none;color:#fff;font-size:20px;cursor:pointer;z-index:500;box-shadow:0 4px 20px rgba(59,130,246,0.4);">☰</button>

  <div class="topbar">
      <div class="topbar-left">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span id="page-title">Dashboard</span>
      </div>
      <div class="topbar-right">
        <div class="tb-bell" onclick="toggleNotif()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        </div>
        <div class="tb-avatar" id="avatar-el" onclick="toggleProfile()">SW</div>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="content-area">

      <!-- ════════════════════ DASHBOARD PAGE ════════════════════ -->
      <div class="page active" id="page-dashboard">

        <!-- REAL TradingView ticker tape widget -->
        <div class="tv-ticker">
          <iframe src="https://s.tradingview.com/embed-widget/ticker-tape/?locale=en#%7B%22symbols%22%3A%5B%7B%22proName%22%3A%22BITSTAMP%3ABTCUSD%22%2C%22title%22%3A%22Bitcoin%22%7D%2C%7B%22proName%22%3A%22COMEX%3AGC1!%22%2C%22title%22%3A%22Gold%22%7D%2C%7B%22proName%22%3A%22NASDAQ%3AAAPL%22%2C%22title%22%3A%22Apple%22%7D%2C%7B%22proName%22%3A%22NASDAQ%3ATSLA%22%2C%22title%22%3A%22Tesla%22%7D%2C%7B%22proName%22%3A%22FX_IDC%3AEURUSD%22%2C%22title%22%3A%22EUR%2FUSD%22%7D%2C%7B%22proName%22%3A%22BINANCE%3AETHUSDT%22%2C%22title%22%3A%22Ethereum%22%7D%5D%2C%22showSymbolLogo%22%3Atrue%2C%22isTransparent%22%3Atrue%2C%22displayMode%22%3A%22adaptive%22%2C%22colorTheme%22%3A%22dark%22%7D" scrolling="no" allowtransparency="true" frameborder="0" lang="en"></iframe>
        </div>

        <!-- 2-COL BODY -->
        <div class="dash-body">

          <!-- LEFT -->
          <div class="dash-left">

            <!-- BALANCE CARD -->
            <div class="balance-card">
              <div class="balance-top">
                <div class="balance-top-left">
                  <div class="balance-icon">⚖️</div>
                  <span class="balance-lbl">Available Balance</span>
                </div>
                <button class="dots-btn" onclick="toggleBalMenu()">
                  <span></span><span></span><span></span>
                </button>
              </div>
              <div class="balance-amount" id="bal-display">$0.00</div>
              <div class="balance-badge" id="balance-badge-el">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="18 15 12 9 6 15"/></svg>
                0%
              </div>
              <div class="bal-stats">
                <div class="bal-stat-card">
                  <div class="bal-stat-lbl">Total Balance</div>
                  <div class="bal-stat-val blue" id="stat-total">$0.00</div>
                </div>
                <div class="bal-stat-card">
                  <div class="bal-stat-lbl">Total Deposited</div>
                  <div class="bal-stat-val" id="stat-deposited">$0.00</div>
                </div>
                <div class="bal-stat-card">
                  <div class="bal-stat-lbl">Total Profit</div>
                  <div class="bal-stat-val green" id="stat-profit">$0.00</div>
                </div>
              </div>
            </div>

            <!-- PROMO BANNER -->
            <div class="promo" id="promo-banner">
              <h3>Get more powerful features now!</h3>
              <p>Unlock advanced trading tools today with a limited 20% discount across our platform upgrades now available.</p>
              <div class="promo-btns">
                <button class="promo-btn-white" onclick="switchPage('subscribe',null)">Upgrade to Pro</button>
                <button class="promo-btn-ghost" onclick="switchPage('subscribe',null)">Get 20% off for today</button>
              </div>
            </div>

            <!-- BUY / SELL / CONVERT -->
            <div class="bsc-row">
              <button class="bsc-btn active-buy" id="bsc-buy" onclick="setBSC('buy')">Buy</button>
              <button class="bsc-btn" id="bsc-sell" onclick="setBSC('sell')">Sell</button>
              <button class="bsc-btn" id="bsc-convert" onclick="setBSC('convert')">Convert</button>
            </div>

            <!-- TRADE FORM -->
            <div id="trade-form-area">
              <label class="t-label">Type</label>
              <select class="t-select" id="trade-type-sel" onchange="updateTradeAsset()">
                <option value="crypto">Crypto</option>
                <option value="stocks">Stocks</option>
                <option value="forex">Forex</option>
                <option value="commodities">Commodities</option>
              </select>

              <label class="t-label">Amount</label>
              <div class="amount-wrap">
                <input class="t-input" type="number" placeholder="100" id="trade-amt-inp"/>
                <div class="amount-asset" id="asset-badge">
                  BTC
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </div>
              </div>
              <div class="current-bal">Current BTC balance: <span id="trade-bal-show">$0.00</span></div>

              <div class="sltp-grid">
                <div class="sltp-col">
                  <label>Stop Loss:</label>
                  <div class="sltp-input-wrap">
                    <input class="sltp-input" type="number" placeholder="0.00" id="sl-inp"/>
                    <span class="sltp-badge" id="sl-badge">BTC</span>
                  </div>
                </div>
                <div class="sltp-col">
                  <label>Take Profit:</label>
                  <div class="sltp-input-wrap">
                    <input class="sltp-input" type="number" placeholder="0.00" id="tp-inp"/>
                    <span class="sltp-badge" id="tp-badge">BTC</span>
                  </div>
                </div>
              </div>

              <div class="lev-label">Leverage:</div>
              <div class="lev-row">
                <input class="lev-input" type="text" placeholder="Enter leverage..." id="lev-inp"/>
                <div class="lev-chip" onclick="pickLev(this,'50x')">50x</div>
                <div class="lev-chip" onclick="pickLev(this,'250x')">250x</div>
                <div class="lev-chip" onclick="pickLev(this,'500x')">500x</div>
              </div>

              <label class="t-label">Duration:</label>
              <select class="t-select" id="dur-sel">
                <option>2 Minutes</option>
                <option>5 Minutes</option>
                <option>15 Minutes</option>
                <option>30 Minutes</option>
                <option>1 Hour</option>
                <option>4 Hours</option>
                <option>1 Day</option>
              </select>

              <button class="action-btn buy" id="trade-action-btn" onclick="placeTrade()">Buy</button>
            </div>

            <!-- TRADES TABLE -->
            <div class="trades-wrap">
              <div class="trades-header">
                <span class="trades-word">Trades</span>
                <button class="trades-tab active" onclick="tradeTab('open',this)" id="tab-open">Open</button>
                <button class="trades-tab" onclick="tradeTab('closed',this)" id="tab-closed">Closed</button>
              </div>
              <div class="trades-search-row">
                <input class="trades-search" type="text" placeholder="Search for deposits..."/>
                <select class="trades-filter">
                  <option>All</option><option>Crypto</option><option>Stocks</option><option>Forex</option>
                </select>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Date</th><th>Reference</th><th>Type</th>
                    <th>Amount</th><th>Leverage</th><th>Stop Loss</th>
                    <th>Take Profit</th><th>Duration</th>
                  </tr>
                </thead>
                <tbody id="trades-body">
                  <tr><td class="empty-td" colspan="8">No open trades yet</td></tr>
                </tbody>
              </table>
            </div>

          </div><!-- /dash-left -->

          <!-- RIGHT COLUMN -->
          <div class="dash-right">

            <!-- Categories -->
            <div class="right-block">
              <div class="right-block-title">Categories</div>
              <div class="right-block-sub">No categories yet. <a href="#" onclick="switchPage('deposit',null)">Deposit now</a> to see your portfolio breakdown.</div>
            </div>

            <!-- Signal strength -->
            <div class="right-block">
              <div class="sig-row">
                <span class="sig-lbl">Signal strength</span>
                <span class="sig-pct" id="sig-pct-el">0%</span>
              </div>
              <div class="sig-track">
                <div class="sig-fill" id="sig-fill-el" style="width:0%"></div>
              </div>
            </div>

            <!-- TradingView Advanced Chart -->
            <div class="tv-chart">
              <iframe
                src="https://s.tradingview.com/widgetembed/?frameElementId=tv_adv&symbol=NASDAQ%3AAAPL&interval=D&hidesidetoolbar=0&symboledit=1&saveimage=0&toolbarbg=1a1a1a&studies=[]&theme=dark&style=1&timezone=Etc%2FUTC&withdateranges=1&showpopupbutton=1&locale=en&hide_top_toolbar=0&allow_symbol_change=1"
                height="320"
                allowtransparency="true"
                allowfullscreen=""
                frameborder="0">
              </iframe>
            </div>

            <!-- Your Top Assets -->
            <div class="assets-block">
              <div class="assets-title">Your Top Assets</div>
              <div class="assets-search-row">
                <input class="assets-search" type="text" placeholder="Search for assets..."/>
                <select class="assets-filter">
                  <option>All</option><option>Crypto</option><option>Stock</option><option>Forex</option>
                </select>
              </div>
              <div class="assets-thead">
                <span>Asset</span><span>Amount</span><span>Type</span><span>Value</span>
              </div>
              <!-- Asset rows -->
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(247,147,26,0.18);color:#f7931a">₿</div>
                  <div class="asset-name">Bitcoin<small>/BTC</small></div>
                </div>
                <div class="asset-amt" id="btc-amt-r">0</div>
                <div class="asset-type">Crypto</div>
                <div class="asset-val" id="btc-val-r">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(255,255,255,0.08);color:#ccc">🍎</div>
                  <div class="asset-name">Apple<small>/AAPL</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Stock</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(100,100,255,0.15);color:#8888ff">A</div>
                  <div class="asset-name">AAVE<small>/AAVE</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Crypto</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(0,200,180,0.15);color:#00b8b0">A</div>
                  <div class="asset-name">Abbot Labs<small>/ABT</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Stock</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(0,200,120,0.15);color:#00c878">₳</div>
                  <div class="asset-name">Cardano<small>/ADA</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Crypto</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(255,60,60,0.15);color:#ff5f5f">A</div>
                  <div class="asset-name">Adobe<small>/ADBE</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Stock</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(30,30,30,0.8);color:#aaa">▶</div>
                  <div class="asset-name">Analog Dev.<small>/ADI</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Stock</div>
                <div class="asset-val">$0.00</div>
              </div>
              <div class="asset-row">
                <div class="asset-info">
                  <div class="asset-ico" style="background:rgba(255,120,0,0.15);color:#ff8c00">A</div>
                  <div class="asset-name">Algorand<small>/ALGO</small></div>
                </div>
                <div class="asset-amt">0</div>
                <div class="asset-type">Crypto</div>
                <div class="asset-val">$0.00</div>
              </div>
            </div>

          </div><!-- /dash-right -->
        </div><!-- /dash-body -->
      </div><!-- /page-dashboard -->

      <!-- ════════════════════ DEPOSIT PAGE ════════════════════ -->
      <div class="page" id="page-deposit">
        <div style="display:flex;align-items:center;justify-content:center;height:60vh;flex-direction:column;gap:16px;">
          <div style="font-size:48px;">💰</div>
          <div style="font-size:18px;font-weight:700;">Ready to Deposit?</div>
          <div style="color:#888;font-size:13px;">Click the button below to start your deposit</div>
          <button class="sub-btn" style="width:auto;padding:12px 32px;" onclick="openDepositModal()">Make a Deposit</button>
        </div>
      </div>

      <!-- ════════════════════ WITHDRAW PAGE ════════════════════ -->
      <div class="page" id="page-withdraw">
        <div class="inner-wrap">
          <div class="inner-title">💸 Withdraw Funds</div>
          <div class="inner-sub">Withdrawals are reviewed and processed within 24 hours.</div>
          <div class="f-group">
            <label>Available Balance</label>
            <div class="avail-bal" id="wd-avail-show">$0.00</div>
          </div>
          <div class="f-group">
            <label>Amount (USD)</label>
            <input type="number" id="wd-amt" placeholder="e.g. 200"/>
          </div>
          <div class="f-group">
            <label>Withdrawal Method</label>
            <select id="wd-method">
              <option value="">Select method...</option>
              <option>Bitcoin (BTC)</option>
              <option>Bank Transfer</option>
              <option>USDT (TRC20)</option>
            </select>
          </div>
          <div class="f-group">
            <label>Your Wallet / Account Number</label>
            <input type="text" id="wd-acct" placeholder="BTC address or bank account number"/>
          </div>
          <button class="sub-btn" onclick="doWithdraw()">Submit Withdrawal Request</button>
          <div class="msg-box" id="wd-msg"></div>
        </div>
      </div>

      <!-- ════════════════════ ASSETS PAGE ════════════════════ -->
      <div class="page" id="page-assets">
        <div class="inner-wrap" style="max-width:900px">
          <div class="inner-title">📦 My Assets</div>
          <div class="inner-sub">Full portfolio breakdown across all asset classes.</div>
          <table>
            <thead><tr><th>Asset</th><th>Amount</th><th>Type</th><th>Price</th><th>Value</th></tr></thead>
            <tbody>
              <tr><td><div style="display:flex;align-items:center;gap:8px"><div class="asset-ico" style="width:24px;height:24px;border-radius:50%;background:rgba(247,147,26,0.18);color:#f7931a;display:flex;align-items:center;justify-content:center;font-size:11px;">₿</div>Bitcoin <small style="color:var(--gray)">/BTC</small></div></td><td id="pa-btc-amt">0</td><td>Crypto</td><td id="pa-btc-price">$--</td><td id="pa-btc-val">$0.00</td></tr>
              <tr><td><div style="display:flex;align-items:center;gap:8px"><div class="asset-ico" style="width:24px;height:24px;border-radius:50%;background:rgba(100,100,255,0.15);color:#627eea;display:flex;align-items:center;justify-content:center;font-size:11px;">Ξ</div>Ethereum <small style="color:var(--gray)">/ETH</small></div></td><td>0</td><td>Crypto</td><td id="pa-eth-price">$--</td><td>$0.00</td></tr>
              <tr><td><div style="display:flex;align-items:center;gap:8px"><div style="width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-size:11px;">🍎</div>Apple <small style="color:var(--gray)">/AAPL</small></div></td><td>0</td><td>Stock</td><td>$224.50</td><td>$0.00</td></tr>
              <tr><td><div style="display:flex;align-items:center;gap:8px"><div style="width:24px;height:24px;border-radius:50%;background:rgba(245,158,11,0.12);display:flex;align-items:center;justify-content:center;font-size:11px;">🥇</div>Gold <small style="color:var(--gray)">/XAU</small></div></td><td>0</td><td>Commodity</td><td>$2,045</td><td>$0.00</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ════════════════════ MARKETS PAGE ════════════════════ -->
      <div class="page" id="page-markets">
        <div class="inner-wrap" style="max-width:900px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
            <div>
              <div class="inner-title" style="margin-bottom:2px;">📈 Live Market Prices</div>
              <div style="font-size:12px;color:var(--gray);">Real-time prices — updates every 10 seconds</div>
            </div>
            <div style="display:flex;gap:8px;">
              <button class="wl-filter-btn active" onclick="setWLFilter('all',this)">All</button>
              <button class="wl-filter-btn" onclick="setWLFilter('crypto',this)">Crypto</button>
              <button class="wl-filter-btn" onclick="setWLFilter('stocks',this)">Stocks</button>
              <button class="wl-filter-btn" onclick="setWLFilter('forex',this)">Forex</button>
            </div>
          </div>

          <div id="wl-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;">
            <!-- Populated by JS -->
            <div style="color:var(--gray);font-size:13px;padding:20px;">Loading live prices...</div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ TRADE PAGE ════════════════════ -->
      <div class="page" id="page-trade">
        <div class="fullframe-page">
          <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tv_trade&symbol=BINANCE%3ABTCUSDT&interval=15&theme=dark&style=1&locale=en&toolbar_bg=1a1a1a&allow_symbol_change=1&hide_side_toolbar=0" allowtransparency="true" allowfullscreen=""></iframe>
        </div>
      </div>

      <!-- ════════════════════ SUBSCRIBE PAGE ════════════════════ -->
      <div class="page" id="page-subscribe">
        <div class="sub-page-wrap">

          <!-- Current Plan Banner -->
          <div id="current-plan-banner" style="display:none;background:linear-gradient(135deg,rgba(59,130,246,0.12),rgba(6,182,212,0.08));border:1px solid rgba(59,130,246,0.25);border-radius:12px;padding:16px 20px;margin-bottom:28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
            <div style="display:flex;align-items:center;gap:12px;">
              <div style="font-size:22px;">🏆</div>
              <div>
                <div style="font-size:13px;font-weight:700;color:var(--white);">Your Current Plan: <span id="banner-tier-name" style="color:var(--blue);">Starter</span></div>
                <div style="font-size:11px;color:var(--gray);margin-top:2px;">Upgrade anytime to unlock higher returns and features.</div>
              </div>
            </div>
            <div id="banner-tier-badge" style="background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);color:var(--blue);font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;letter-spacing:0.5px;">STARTER TIER</div>
          </div>

          <div class="sub-page-title">Investment Plans</div>
          <div class="sub-page-sub">Transparent returns. No hidden fees. Start with any amount.</div>
          <div class="plan-cards">

            <!-- STARTER -->
            <div class="plan-card" id="plan-card-starter">
              <div class="plan-label">Starter Plan</div>
              <div class="plan-pct"><sup></sup>5<sup style="font-size:22px">%</sup></div>
              <div class="plan-freq">Weekly Return</div>
              <div class="plan-minmax">Min: <span>$100</span> · Max: <span>$4,999</span></div>
              <ul class="plan-features">
                <li>Weekly profit credited</li>
                <li>Crypto and Forex markets</li>
                <li>Basic analytics dashboard</li>
                <li>Email support</li>
                <li>Withdraw anytime</li>
                <li style="color:#e74c3c;">Limited balance: $10,000</li>
              </ul>
              <button class="plan-get-btn" id="plan-btn-starter" onclick="selectPlan('Starter','$100 - $4,999')">Get Started</button>
            </div>

            <!-- GROWTH (featured) -->
            <div class="plan-card featured" id="plan-card-growth">
              <div class="plan-badge">Most Popular</div>
              <div class="plan-label">Growth Plan</div>
              <div class="plan-pct"><sup></sup>12<sup style="font-size:22px">%</sup></div>
              <div class="plan-freq">Weekly Return</div>
              <div class="plan-minmax">Min: <span>$5,000</span> · Max: <span>$49,999</span></div>
              <ul class="plan-features">
                <li>Daily profit credited</li>
                <li>Crypto, Forex and Stocks</li>
                <li>Advanced analytics</li>
                <li>Priority 24/7 support</li>
                <li>Dedicated account manager</li>
                <li style="color:#3b82f6;">Balance limit: $100,000</li>
              </ul>
              <button class="plan-get-btn" id="plan-btn-growth" onclick="selectPlan('Growth','$5,000 - $49,999')">Get Started</button>
            </div>

            <!-- ELITE -->
            <div class="plan-card" id="plan-card-elite">
              <div class="plan-label">Elite Plan</div>
              <div class="plan-pct"><sup></sup>20<sup style="font-size:22px">%</sup></div>
              <div class="plan-freq">Weekly Return</div>
              <div class="plan-minmax">Min: <span>$50,000</span> · No maximum</div>
              <ul class="plan-features">
                <li>Daily profit credited</li>
                <li>All markets and commodities</li>
                <li>VIP analytics suite</li>
                <li>Personal trader assigned</li>
                <li>Tax reporting support</li>
                <li style="color:#00C896;font-weight:700;">Unlimited balance</li>
              </ul>
              <button class="plan-get-btn" id="plan-btn-elite" onclick="selectPlan('Elite','$50,000+')">Get Started</button>
            </div>

          </div>
        </div>
      </div>


      <!-- ════════════════════ SWAP PAGE ════════════════════ -->
      <div class="page" id="page-swap">
        <div class="inner-wrap">
          <div class="inner-title">🔄 Swap Assets</div>
          <div class="inner-sub">Instantly exchange between assets at the best rates.</div>
          <div style="margin-top:32px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:28px;max-width:420px;">
            <div class="f-group"><label>From</label><select class="t-select"><option>Bitcoin (BTC)</option><option>Ethereum (ETH)</option><option>USDT</option></select></div>
            <div style="text-align:center;margin:8px 0;color:var(--gray);font-size:20px;cursor:pointer;">⇅</div>
            <div class="f-group"><label>To</label><select class="t-select"><option>USDT</option><option>Bitcoin (BTC)</option><option>Ethereum (ETH)</option></select></div>
            <div class="f-group"><label>Amount</label><input class="t-input" type="number" placeholder="0.00"/></div>
            <button class="sub-btn">Swap Now</button>
          </div>
        </div>
      </div>

      <!-- ════════════════════ REFERRALS PAGE ════════════════════ -->
      <div class="page" id="page-referrals">
        <div class="inner-wrap" style="max-width:760px;">
          <div class="inner-title">👥 Referral Program</div>
          <div class="inner-sub">Invite friends and earn <strong style="color:var(--green);">$10</strong> for every friend who joins and makes their first deposit.</div>

          <!-- Stats row -->
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;">
            <div class="ref-stat-card"><div class="ref-stat-num" id="ref-total-count">0</div><div class="ref-stat-lbl">Total Referrals</div></div>
            <div class="ref-stat-card"><div class="ref-stat-num" id="ref-active-count" style="color:var(--green);">0</div><div class="ref-stat-lbl">Active (Deposited)</div></div>
            <div class="ref-stat-card"><div class="ref-stat-num" id="ref-earned" style="color:var(--blue);">$0</div><div class="ref-stat-lbl">Total Earned</div></div>
          </div>

          <!-- Referral link -->
          <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;margin-bottom:20px;">
            <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:10px;">Your Referral Link</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <input class="t-input" id="ref-link-input" readonly style="flex:1;min-width:200px;font-size:11px;color:var(--gray);"/>
              <button onclick="copyRefLink()" class="sub-btn" style="width:auto;padding:10px 20px;white-space:nowrap;">📋 Copy Link</button>
            </div>
            <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
              <button onclick="shareRefLink('whatsapp')" style="background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.2);color:#25d366;padding:8px 14px;border-radius:7px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;">WhatsApp</button>
              <button onclick="shareRefLink('twitter')" style="background:rgba(29,161,242,0.1);border:1px solid rgba(29,161,242,0.2);color:#1da1f2;padding:8px 14px;border-radius:7px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;">Twitter / X</button>
              <button onclick="shareRefLink('telegram')" style="background:rgba(0,136,204,0.1);border:1px solid rgba(0,136,204,0.2);color:#0088cc;padding:8px 14px;border-radius:7px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;">Telegram</button>
              <button onclick="shareRefLink('email')" style="background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);color:var(--blue);padding:8px 14px;border-radius:7px;font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;">Email</button>
            </div>
          </div>

          <!-- How it works -->
          <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;margin-bottom:20px;">
            <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:16px;">How It Works</div>
            <div style="display:flex;flex-direction:column;gap:14px;">
              <div style="display:flex;align-items:flex-start;gap:14px;">
                <div style="width:32px;height:32px;border-radius:50%;background:rgba(59,130,246,0.15);color:var(--blue);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0;">1</div>
                <div><div style="font-size:13px;font-weight:600;">Share your link</div><div style="font-size:11px;color:var(--gray);margin-top:2px;">Send your unique referral link to friends and family via any platform.</div></div>
              </div>
              <div style="display:flex;align-items:flex-start;gap:14px;">
                <div style="width:32px;height:32px;border-radius:50%;background:rgba(16,185,129,0.15);color:var(--green);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0;">2</div>
                <div><div style="font-size:13px;font-weight:600;">They sign up and deposit</div><div style="font-size:11px;color:var(--gray);margin-top:2px;">Your friend creates an account using your link and makes their first deposit.</div></div>
              </div>
              <div style="display:flex;align-items:flex-start;gap:14px;">
                <div style="width:32px;height:32px;border-radius:50%;background:rgba(245,158,11,0.15);color:#f59e0b;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0;">3</div>
                <div><div style="font-size:13px;font-weight:600;">You earn $10</div><div style="font-size:11px;color:var(--gray);margin-top:2px;">As soon as their deposit is approved you receive $10 credited to your balance.</div></div>
              </div>
            </div>
          </div>

          <!-- Referral history list -->
          <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;">
            <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:14px;">Your Referrals</div>
            <div id="ref-list">
              <div style="text-align:center;color:var(--gray);padding:24px;font-size:13px;">Loading your referrals...</div>
            </div>
          </div>
        </div>
      </div>
      <!-- ════════════════════ SIGNALS PAGE ════════════════════ -->
      <div class="page" id="page-signals">
        <div class="simple-page">
          <h2>📡 Trading Signals</h2>
          <div class="sub">Live signals from our expert analysts. Upgrade to Pro to unlock all signals.</div>
          <div class="signal-cards">
            <div class="signal-card"><div class="signal-card-left"><h4>BTC/USD — BUY</h4><p>Entry: $95,000 · Target: $102,000 · Stop: $91,000</p></div><div class="sig-chip sig-buy">STRONG BUY</div></div>
            <div class="signal-card"><div class="signal-card-left"><h4>ETH/USD — BUY</h4><p>Entry: $3,200 · Target: $3,800 · Stop: $2,900</p></div><div class="sig-chip sig-buy">BUY</div></div>
            <div class="signal-card"><div class="signal-card-left"><h4>AAPL — HOLD</h4><p>Current: $224.50 · Analyst target: $240.00</p></div><div class="sig-chip sig-hold">HOLD</div></div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ STAKE PAGE ════════════════════ -->
      <div class="page" id="page-stake">
        <div class="simple-page">
          <h2>🏆 Stake Assets</h2>
          <div class="sub">Earn passive rewards by staking your crypto assets.</div>
          <div class="stake-cards">
            <div class="stake-card"><div class="stake-card-top"><div class="stake-ico" style="background:rgba(247,147,26,0.18);color:#f7931a">₿</div><div><div style="font-weight:600;font-size:13px">Bitcoin</div><div style="color:var(--gray);font-size:11px">BTC</div></div></div><div class="stake-apy">4.5% APY</div><div class="stake-period">30-day lock period</div><button class="stake-btn">Stake BTC</button></div>
            <div class="stake-card"><div class="stake-card-top"><div class="stake-ico" style="background:rgba(100,100,255,0.15);color:#627eea">Ξ</div><div><div style="font-weight:600;font-size:13px">Ethereum</div><div style="color:var(--gray);font-size:11px">ETH</div></div></div><div class="stake-apy">6.2% APY</div><div class="stake-period">60-day lock period</div><button class="stake-btn">Stake ETH</button></div>
          </div>
        </div>
      </div>


      <!-- ════════════════════ USER PROFILE PAGE ════════════════════ -->
      <div class="page" id="page-user-profile">
        <div class="inner-wrap" style="max-width:680px;">
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:28px;padding:24px;background:var(--card);border:1px solid var(--border);border-radius:14px;">
            <div id="prof-avatar-big" style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#06b6d4);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:800;color:#fff;flex-shrink:0;">SW</div>
            <div style="flex:1;">
              <div style="font-size:20px;font-weight:800;" id="prof-name-big">Loading...</div>
              <div style="color:var(--gray);font-size:13px;margin-top:2px;" id="prof-email-big">--</div>
              <div style="display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap;">
                <div id="prof-verified-badge" style="display:inline-flex;align-items:center;gap:5px;background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.25);color:#e74c3c;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;">● NOT VERIFIED</div>
                <div id="prof-tier-badge" style="display:inline-flex;align-items:center;gap:5px;background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.25);color:#3b82f6;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;">STARTER TIER</div>
              </div>
            </div>
            <button onclick="switchPage('personal-info',null)" style="background:var(--blue);color:#fff;border:none;padding:9px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;">Edit Profile</button>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div class="prof-info-card"><div class="prof-info-label">Full Name</div><div class="prof-info-val" id="pi-fullname">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Email Address</div><div class="prof-info-val" id="pi-email2">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Phone Number</div><div class="prof-info-val" id="pi-phone">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Age</div><div class="prof-info-val" id="pi-age">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Country of Residence</div><div class="prof-info-val" id="pi-country">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Home Address</div><div class="prof-info-val" id="pi-address">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Account Tier</div><div class="prof-info-val" id="pi-tier">Starter</div></div>
            <div class="prof-info-card"><div class="prof-info-label">KYC Status</div><div class="prof-info-val" id="pi-kyc" style="color:#e74c3c;">Not Verified</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Member Since</div><div class="prof-info-val" id="pi-since">—</div></div>
            <div class="prof-info-card"><div class="prof-info-label">Account ID</div><div class="prof-info-val" id="pi-uid" style="font-size:10px;word-break:break-all;">—</div></div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ PERSONAL INFO PAGE ════════════════════ -->
      <div class="page" id="page-personal-info">
        <div class="inner-wrap" style="max-width:620px;">
          <div class="inner-title">Personal Information</div>
          <div class="inner-sub" style="margin-bottom:24px;">Update your profile details. Changes are saved to your account.</div>

          <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:20px;">
            <div style="font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:16px;">Personal Details</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
              <div class="f-group"><label>Full Name</label><input class="t-input" id="pi-edit-name" placeholder="Your full name"/></div>
              <div class="f-group"><label>Age</label><input class="t-input" id="pi-edit-age" type="number" placeholder="Your age"/></div>
              <div class="f-group"><label>Phone Number</label><input class="t-input" id="pi-edit-phone" placeholder="+1 234 567 8900"/></div>
              <div class="f-group"><label>Country of Residence</label>
                <select class="t-select" id="pi-edit-country">
                  <option value="">Select country...</option>
                  <option>United States</option><option>United Kingdom</option><option>Germany</option><option>France</option><option>Italy</option><option>Spain</option><option>Canada</option><option>Australia</option><option>Netherlands</option><option>Switzerland</option><option>Sweden</option><option>Norway</option><option>Denmark</option><option>Belgium</option><option>Austria</option><option>Portugal</option><option>Poland</option><option>Czech Republic</option><option>Other</option>
                </select>
              </div>
            </div>
            <div class="f-group" style="margin-top:14px;"><label>Home Address</label><input class="t-input" id="pi-edit-address" placeholder="Street, City, State, ZIP"/></div>
            <button onclick="savePersonalInfo()" class="sub-btn" style="margin-top:18px;">💾 Save Changes</button>
            <div id="pi-msg" style="font-size:12px;margin-top:10px;"></div>
          </div>

          <!-- KYC SECTION -->
          <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;">
            <div style="font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:6px;">KYC Verification</div>
            <div style="font-size:12px;color:var(--gray);margin-bottom:18px;">Verify your identity using a government-approved ID to unlock full account features.</div>
            <div id="kyc-status-banner" style="display:none;padding:12px 16px;border-radius:8px;font-size:12px;font-weight:600;margin-bottom:16px;"></div>
            <div id="kyc-form">
              <div class="f-group"><label>ID Type</label>
                <select class="t-select" id="kyc-id-type">
                  <option value="">Select ID type...</option>
                  <option value="passport">International Passport</option>
                  <option value="national_id">National ID Card</option>
                  <option value="drivers_license">Driver's License</option>
                </select>
              </div>
              <div class="f-group" style="margin-top:14px;"><label>ID Number</label><input class="t-input" id="kyc-id-number" placeholder="Enter your ID number"/></div>
              <div class="f-group" style="margin-top:14px;">
                <label>Upload ID Document (front)</label>
                <div id="kyc-drop-zone" onclick="document.getElementById('kyc-file').click()" style="border:2px dashed var(--border2);border-radius:8px;padding:28px;text-align:center;cursor:pointer;transition:border 0.2s;margin-top:6px;">
                  <div style="font-size:28px;margin-bottom:8px;">📄</div>
                  <div style="font-size:13px;color:var(--white);font-weight:600;">Click to upload or drag & drop</div>
                  <div style="font-size:11px;color:var(--gray);margin-top:4px;">JPG, PNG or PDF — max 5MB</div>
                  <div id="kyc-file-name" style="font-size:11px;color:var(--green);margin-top:8px;"></div>
                </div>
                <input type="file" id="kyc-file" accept="image/*,.pdf" style="display:none" onchange="onKycFileSelect(this)"/>
              </div>
              <button onclick="submitKYC()" class="sub-btn" style="margin-top:18px;">🔐 Submit for Verification</button>
              <div id="kyc-msg" style="font-size:12px;margin-top:10px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ SECURITY PAGE ════════════════════ -->
      <div class="page" id="page-security">
        <div class="inner-wrap" style="max-width:580px;">
          <div class="inner-title">Security</div>
          <div class="inner-sub" style="margin-bottom:24px;">Manage your account security. All changes require your current password.</div>

          <!-- Change Password -->
          <div class="sec-card">
            <div class="sec-card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Change Password</div>
            <div class="f-group"><label>Current Password</label><div class="pw-wrap"><input class="t-input" type="password" id="sec-cur-pw" placeholder="Enter current password"/><button class="pw-eye" onclick="togglePw('sec-cur-pw',this)">👁</button></div></div>
            <div class="f-group"><label>New Password</label><div class="pw-wrap"><input class="t-input" type="password" id="sec-new-pw" placeholder="Min 8 characters"/><button class="pw-eye" onclick="togglePw('sec-new-pw',this)">👁</button></div></div>
            <div class="f-group"><label>Confirm New Password</label><div class="pw-wrap"><input class="t-input" type="password" id="sec-conf-pw" placeholder="Repeat new password"/><button class="pw-eye" onclick="togglePw('sec-conf-pw',this)">👁</button></div></div>
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-top:14px;">
              <button onclick="changePassword()" class="sub-btn" style="width:auto;padding:10px 22px;">Update Password</button>
              <button onclick="resetPasswordEmail()" style="background:none;border:none;color:var(--blue);font-size:12px;cursor:pointer;font-family:inherit;text-decoration:underline;">Forgot password? Reset via email</button>
            </div>
            <div id="sec-pw-msg" style="font-size:12px;margin-top:10px;"></div>
          </div>

          <!-- Change Email -->
          <div class="sec-card">
            <div class="sec-card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg> Change Email</div>
            <div class="f-group"><label>Current Password</label><div class="pw-wrap"><input class="t-input" type="password" id="sec-email-pw" placeholder="Enter current password"/><button class="pw-eye" onclick="togglePw('sec-email-pw',this)">👁</button></div></div>
            <div class="f-group"><label>New Email Address</label><input class="t-input" type="email" id="sec-new-email" placeholder="new@email.com"/></div>
            <button onclick="changeEmail()" class="sub-btn" style="margin-top:14px;width:auto;padding:10px 22px;">Update Email</button>
            <div id="sec-email-msg" style="font-size:12px;margin-top:10px;"></div>
          </div>

          <!-- Change Phone -->
          <div class="sec-card">
            <div class="sec-card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 13a19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 3.56 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 9.91a16 16 0 0 0 6.29 6.29l.91-.91a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg> Change Phone Number</div>
            <div class="f-group"><label>Current Password</label><div class="pw-wrap"><input class="t-input" type="password" id="sec-phone-pw" placeholder="Enter current password"/><button class="pw-eye" onclick="togglePw('sec-phone-pw',this)">👁</button></div></div>
            <div class="f-group"><label>New Phone Number</label><input class="t-input" type="tel" id="sec-new-phone" placeholder="+1 234 567 8900"/></div>
            <button onclick="changePhone()" class="sub-btn" style="margin-top:14px;width:auto;padding:10px 22px;">Update Phone</button>
            <div id="sec-phone-msg" style="font-size:12px;margin-top:10px;"></div>
          </div>

          <!-- 2FA -->
          <div class="sec-card">
            <div class="sec-card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg> Two-Factor Authentication (2FA)</div>
            <div style="font-size:12px;color:var(--gray);margin-bottom:14px;line-height:1.6;">Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you log in.</div>
            <div style="display:flex;align-items:center;justify-content:space-between;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px 16px;">
              <div>
                <div style="font-size:13px;font-weight:600;">Authenticator App</div>
                <div style="font-size:11px;color:var(--gray);margin-top:2px;" id="twofa-status">Status: Not enabled</div>
              </div>
              <button id="twofa-btn" onclick="toggle2FA()" style="background:var(--blue);color:#fff;border:none;padding:8px 16px;border-radius:7px;font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;">Enable 2FA</button>
            </div>
            <div id="sec-2fa-msg" style="font-size:12px;margin-top:10px;"></div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ SETTINGS PAGE ════════════════════ -->
      <div class="page" id="page-settings">
        <div class="inner-wrap" style="max-width:680px;">
          <div class="inner-title">⚙️ Settings</div>
          <div class="inner-sub" style="margin-bottom:28px;">Customize your SwiftExpress experience.</div>

          <!-- Appearance -->
          <div class="sec-card">
            <div class="sec-card-title">🎨 Appearance</div>
            <div class="f-group"><label>Theme</label>
              <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:8px;">
                <div class="theme-opt active-theme" onclick="setTheme('dark',this)" id="theme-dark" style="border:2px solid var(--blue);background:#111;border-radius:8px;padding:12px;text-align:center;cursor:pointer;">
                  <div style="font-size:18px;">🌑</div><div style="font-size:11px;margin-top:4px;font-weight:600;">Dark</div>
                </div>
                <div class="theme-opt" onclick="setTheme('midnight',this)" id="theme-midnight" style="border:2px solid var(--border);background:#090912;border-radius:8px;padding:12px;text-align:center;cursor:pointer;">
                  <div style="font-size:18px;">🌌</div><div style="font-size:11px;margin-top:4px;font-weight:600;">Midnight</div>
                </div>
                <div class="theme-opt" onclick="setTheme('dim',this)" id="theme-dim" style="border:2px solid var(--border);background:#1a1f2e;border-radius:8px;padding:12px;text-align:center;cursor:pointer;">
                  <div style="font-size:18px;">🌒</div><div style="font-size:11px;margin-top:4px;font-weight:600;">Dim</div>
                </div>
              </div>
            </div>
            <div class="f-group" style="margin-top:18px;"><label>Accent Color</label>
              <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
                <div class="color-opt" onclick="setAccent('#3b82f6',this)" style="width:32px;height:32px;border-radius:50%;background:#3b82f6;cursor:pointer;border:3px solid #fff;"></div>
                <div class="color-opt" onclick="setAccent('#10b981',this)" style="width:32px;height:32px;border-radius:50%;background:#10b981;cursor:pointer;border:3px solid transparent;"></div>
                <div class="color-opt" onclick="setAccent('#8b5cf6',this)" style="width:32px;height:32px;border-radius:50%;background:#8b5cf6;cursor:pointer;border:3px solid transparent;"></div>
                <div class="color-opt" onclick="setAccent('#f59e0b',this)" style="width:32px;height:32px;border-radius:50%;background:#f59e0b;cursor:pointer;border:3px solid transparent;"></div>
                <div class="color-opt" onclick="setAccent('#ef4444',this)" style="width:32px;height:32px;border-radius:50%;background:#ef4444;cursor:pointer;border:3px solid transparent;"></div>
                <div class="color-opt" onclick="setAccent('#ec4899',this)" style="width:32px;height:32px;border-radius:50%;background:#ec4899;cursor:pointer;border:3px solid transparent;"></div>
              </div>
            </div>
          </div>

          <!-- Notifications -->
          <div class="sec-card">
            <div class="sec-card-title">🔔 Notifications</div>
            <div class="toggle-row"><div><div class="toggle-label">Deposit Confirmations</div><div class="toggle-sub">Get notified when a deposit is approved</div></div><label class="sw-toggle"><input type="checkbox" id="notif-deposit" checked onchange="saveSetting('notif-deposit',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Withdrawal Updates</div><div class="toggle-sub">Get notified on withdrawal status changes</div></div><label class="sw-toggle"><input type="checkbox" id="notif-withdraw" checked onchange="saveSetting('notif-withdraw',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Market Alerts</div><div class="toggle-sub">Price movement alerts for your assets</div></div><label class="sw-toggle"><input type="checkbox" id="notif-market" onchange="saveSetting('notif-market',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Trading Signals</div><div class="toggle-sub">New expert signals and recommendations</div></div><label class="sw-toggle"><input type="checkbox" id="notif-signals" checked onchange="saveSetting('notif-signals',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Promotional Offers</div><div class="toggle-sub">Discounts and platform promotions</div></div><label class="sw-toggle"><input type="checkbox" id="notif-promo" onchange="saveSetting('notif-promo',this.checked)"/><span class="sw-slider"></span></label></div>
          </div>

          <!-- Display Preferences -->
          <div class="sec-card">
            <div class="sec-card-title">📊 Display Preferences</div>
            <div class="toggle-row"><div><div class="toggle-label">Show Balance on Dashboard</div><div class="toggle-sub">Hide or show your balance amount</div></div><label class="sw-toggle"><input type="checkbox" id="pref-showbal" checked onchange="toggleBalanceVisibility(this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Live Price Updates</div><div class="toggle-sub">Auto-refresh BTC prices every 15 seconds</div></div><label class="sw-toggle"><input type="checkbox" id="pref-liveprices" checked onchange="saveSetting('pref-liveprices',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Show Portfolio Change %</div><div class="toggle-sub">Display daily percentage change on balance</div></div><label class="sw-toggle"><input type="checkbox" id="pref-showpct" checked onchange="saveSetting('pref-showpct',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="f-group" style="margin-top:16px;"><label>Default Currency Display</label>
              <select class="t-select" id="pref-currency" onchange="saveSetting('pref-currency',this.value)">
                <option value="USD">USD — US Dollar ($)</option>
                <option value="EUR">EUR — Euro (€)</option>
                <option value="GBP">GBP — British Pound (£)</option>
                <option value="BTC">BTC — Bitcoin (₿)</option>
              </select>
            </div>
          </div>

          <!-- Privacy -->
          <div class="sec-card">
            <div class="sec-card-title">🔒 Privacy</div>
            <div class="toggle-row"><div><div class="toggle-label">Activity Status</div><div class="toggle-sub">Show when you were last active</div></div><label class="sw-toggle"><input type="checkbox" id="priv-activity" onchange="saveSetting('priv-activity',this.checked)"/><span class="sw-slider"></span></label></div>
            <div class="toggle-row"><div><div class="toggle-label">Data Analytics</div><div class="toggle-sub">Help improve the platform with anonymous data</div></div><label class="sw-toggle"><input type="checkbox" id="priv-analytics" checked onchange="saveSetting('priv-analytics',this.checked)"/><span class="sw-slider"></span></label></div>
          </div>

          <!-- Danger Zone -->
          <div class="sec-card" style="border-color:rgba(231,76,60,0.2);">
            <div class="sec-card-title" style="color:#e74c3c;">⚠️ Danger Zone</div>
            <div style="font-size:12px;color:var(--gray);margin-bottom:14px;">These actions are irreversible. Please be certain before proceeding.</div>
            <button onclick="if(confirm('Are you sure you want to log out of all devices?'))alert('Logged out of all devices.')" style="background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.25);color:#e74c3c;padding:10px 20px;border-radius:7px;cursor:pointer;font-size:12px;font-weight:600;font-family:inherit;margin-right:10px;">Logout All Devices</button>
            <button onclick="if(confirm('Delete account? This cannot be undone.'))alert('Please contact support to complete account deletion.')" style="background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.25);color:#e74c3c;padding:10px 20px;border-radius:7px;cursor:pointer;font-size:12px;font-weight:600;font-family:inherit;">Delete Account</button>
          </div>

        </div>
      </div>

      <!-- ════════════════════ CONNECT WALLET PAGE ════════════════════ -->
      <div class="page" id="page-connect-wallet">
        <div class="inner-wrap" style="max-width:600px;">
          <div class="inner-title">🔗 Connect Wallet</div>
          <div class="inner-sub" style="margin-bottom:24px;">Link your external crypto wallet to SwiftExpress for seamless transfers.</div>

          <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--gray);margin-bottom:10px;">Popular</div>
          <div style="display:grid;gap:10px;margin-bottom:20px;">
            <div class="wallet-opt" onclick="showWalletConnect('MetaMask')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#e2761b,#f6851b);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🦊</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">MetaMask</div><div style="font-size:11px;color:var(--gray);">Browser extension &amp; mobile wallet</div></div>
              <div style="font-size:10px;background:rgba(16,185,129,0.1);color:var(--green);border:1px solid rgba(16,185,129,0.2);padding:2px 8px;border-radius:10px;font-weight:700;">Popular</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('WalletConnect')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#3b99fc,#1572ef);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🔵</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">WalletConnect</div><div style="font-size:11px;color:var(--gray);">Scan QR with any mobile wallet</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Coinbase Wallet')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#0052ff,#1a66ff);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🔷</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Coinbase Wallet</div><div style="font-size:11px;color:var(--gray);">Self-custody by Coinbase</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Phantom')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#ab9ff2,#7c5fe0);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">👻</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Phantom</div><div style="font-size:11px;color:var(--gray);">Solana &amp; multi-chain wallet</div></div>
              <div style="font-size:10px;background:rgba(171,159,242,0.1);color:#ab9ff2;border:1px solid rgba(171,159,242,0.2);padding:2px 8px;border-radius:10px;font-weight:700;">Solana</div>
            </div>
          </div>

          <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--gray);margin-bottom:10px;">More Wallets</div>
          <div style="display:grid;gap:10px;">
            <div class="wallet-opt" onclick="showWalletConnect('Trust Wallet')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#3375bb,#2196f3);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🛡️</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Trust Wallet</div><div style="font-size:11px;color:var(--gray);">Multi-chain mobile wallet by Binance</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Exodus')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#0b45db,#8c41ed);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🌀</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Exodus</div><div style="font-size:11px;color:var(--gray);">Desktop &amp; mobile multi-asset wallet</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Ledger')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#142533,#1c3a52);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🔐</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Ledger</div><div style="font-size:11px;color:var(--gray);">Hardware wallet — maximum security</div></div>
              <div style="font-size:10px;background:rgba(59,130,246,0.1);color:var(--blue);border:1px solid rgba(59,130,246,0.2);padding:2px 8px;border-radius:10px;font-weight:700;">Hardware</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Trezor')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#1d9e6b,#00c896);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🟩</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Trezor</div><div style="font-size:11px;color:var(--gray);">Open-source hardware wallet</div></div>
              <div style="font-size:10px;background:rgba(59,130,246,0.1);color:var(--blue);border:1px solid rgba(59,130,246,0.2);padding:2px 8px;border-radius:10px;font-weight:700;">Hardware</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Rainbow')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#ff6b6b,#ffd93d,#6bcb77,#4d96ff);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🌈</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Rainbow</div><div style="font-size:11px;color:var(--gray);">Ethereum &amp; Layer 2 mobile wallet</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('OKX Wallet')">
              <div style="width:40px;height:40px;border-radius:10px;background:#000;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;border:1px solid var(--border);">⬛</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">OKX Wallet</div><div style="font-size:11px;color:var(--gray);">Multi-chain Web3 wallet by OKX</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
            <div class="wallet-opt" onclick="showWalletConnect('Bybit Wallet')">
              <div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#f7a600,#ff6900);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;">🟠</div>
              <div style="flex:1;"><div style="font-weight:700;font-size:13px;">Bybit Wallet</div><div style="font-size:11px;color:var(--gray);">Web3 wallet by Bybit exchange</div></div>
              <div style="color:var(--gray);font-size:16px;">›</div>
            </div>
          </div>

          <!-- Connect modal -->
          <div id="wallet-connect-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:2000;align-items:center;justify-content:center;backdrop-filter:blur(4px);">
            <div style="background:var(--sidebar);border:1px solid var(--border);border-radius:16px;padding:28px;width:320px;text-align:center;">
              <div style="font-size:36px;margin-bottom:12px;" id="wcm-icon">🦊</div>
              <div style="font-size:16px;font-weight:700;margin-bottom:6px;" id="wcm-name">MetaMask</div>
              <div style="font-size:12px;color:var(--gray);margin-bottom:20px;">Follow the prompts in your wallet app to complete the connection.</div>
              <div style="width:48px;height:48px;border:3px solid var(--blue);border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 20px;"></div>
              <div style="font-size:12px;color:var(--gray);margin-bottom:20px;">Waiting for wallet confirmation...</div>
              <button onclick="document.getElementById('wallet-connect-modal').style.display='none'" style="width:100%;background:var(--card);border:1px solid var(--border);color:var(--white);padding:11px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;font-family:inherit;">Cancel</button>
            </div>
          </div>

        </div>
      </div>

      <!-- ════════════════════ COPY EXPERTS PAGE ════════════════════ -->
      <div class="page" id="page-copy-experts">
        <div class="inner-wrap" style="max-width:680px;">
          <div class="inner-title">📋 Copy Experts</div>
          <div class="inner-sub" style="margin-bottom:24px;">Mirror trades from top-performing expert traders automatically.</div>
          <div style="display:grid;gap:14px;">
            <div class="expert-card"><div style="display:flex;align-items:center;gap:14px;"><div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;">AK</div><div style="flex:1;"><div style="font-weight:700;font-size:14px;">Alex Kovacs</div><div style="font-size:11px;color:var(--gray);">BTC &amp; Forex specialist · 4.9★</div></div><div style="text-align:right;"><div style="color:var(--green);font-size:16px;font-weight:800;">+147%</div><div style="font-size:10px;color:var(--gray);">12 months</div></div></div><div style="display:flex;gap:8px;margin-top:14px;"><div class="expert-stat"><div class="expert-stat-val">2,340</div><div class="expert-stat-lbl">Followers</div></div><div class="expert-stat"><div class="expert-stat-val">89%</div><div class="expert-stat-lbl">Win Rate</div></div><div class="expert-stat"><div class="expert-stat-val">$50 min</div><div class="expert-stat-lbl">Min Copy</div></div></div><button onclick="alert('Copy trading coming soon!')" class="sub-btn" style="margin-top:14px;">Copy This Expert</button></div>
            <div class="expert-card"><div style="display:flex;align-items:center;gap:14px;"><div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#8b5cf6,#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;">SR</div><div style="flex:1;"><div style="font-weight:700;font-size:14px;">Sofia Reyes</div><div style="font-size:11px;color:var(--gray);">Stocks &amp; Crypto analyst · 4.8★</div></div><div style="text-align:right;"><div style="color:var(--green);font-size:16px;font-weight:800;">+213%</div><div style="font-size:10px;color:var(--gray);">18 months</div></div></div><div style="display:flex;gap:8px;margin-top:14px;"><div class="expert-stat"><div class="expert-stat-val">5,120</div><div class="expert-stat-lbl">Followers</div></div><div class="expert-stat"><div class="expert-stat-val">92%</div><div class="expert-stat-lbl">Win Rate</div></div><div class="expert-stat"><div class="expert-stat-val">$100 min</div><div class="expert-stat-lbl">Min Copy</div></div></div><button onclick="alert('Copy trading coming soon!')" class="sub-btn" style="margin-top:14px;">Copy This Expert</button></div>
          </div>
        </div>
      </div>


      <!-- ════════════════════ HISTORY PAGE ════════════════════ -->
      <div class="page" id="page-history">
        <div class="inner-wrap" style="max-width:900px;">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:24px;">
            <div>
              <div class="inner-title" style="margin-bottom:2px;">📜 Transaction History</div>
              <div style="font-size:12px;color:var(--gray);">All your deposits, withdrawals and earnings in one place.</div>
            </div>
            <button onclick="exportHistory()" style="background:var(--card);border:1px solid var(--border);color:var(--white);padding:9px 16px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;display:flex;align-items:center;gap:6px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Export CSV
            </button>
          </div>

          <!-- Filters -->
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;align-items:center;">
            <div style="display:flex;gap:6px;">
              <button class="hist-filter hf-type active-hf" onclick="setHistFilter('all',this)">All</button>
              <button class="hist-filter hf-type" onclick="setHistFilter('deposit',this)">Deposits</button>
              <button class="hist-filter hf-type" onclick="setHistFilter('withdrawal',this)">Withdrawals</button>
              <button class="hist-filter hf-type" onclick="setHistFilter('profit',this)">Profits</button>
            </div>
            <div style="display:flex;gap:6px;margin-left:auto;">
              <button class="hist-filter hf-status active-hf" onclick="setHistStatus('all',this)">All Status</button>
              <button class="hist-filter hf-status" onclick="setHistStatus('pending',this)">Pending</button>
              <button class="hist-filter hf-status" onclick="setHistStatus('approved',this)">Approved</button>
            </div>
          </div>

          <!-- Summary cards -->
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;" id="hist-summary">
            <div class="hist-sum-card" style="background:rgba(59,130,246,0.08);border-color:rgba(59,130,246,0.2);">
              <div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--blue);margin-bottom:4px;">Total Deposited</div>
              <div style="font-size:20px;font-weight:800;" id="hist-total-dep">$0.00</div>
            </div>
            <div class="hist-sum-card" style="background:rgba(239,68,68,0.08);border-color:rgba(239,68,68,0.2);">
              <div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:#ef4444;margin-bottom:4px;">Total Withdrawn</div>
              <div style="font-size:20px;font-weight:800;" id="hist-total-wd">$0.00</div>
            </div>
            <div class="hist-sum-card" style="background:rgba(16,185,129,0.08);border-color:rgba(16,185,129,0.2);">
              <div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--green);margin-bottom:4px;">Total Profit</div>
              <div style="font-size:20px;font-weight:800;" id="hist-total-profit">$0.00</div>
            </div>
          </div>

          <!-- Transactions list -->
          <div style="overflow-x:auto;border-radius:10px;border:1px solid var(--border);">
            <table style="width:100%;border-collapse:collapse;">
              <thead>
                <tr style="background:var(--card);border-bottom:1px solid var(--border);">
                  <th style="text-align:left;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">Date</th>
                  <th style="text-align:left;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">Type</th>
                  <th style="text-align:left;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">Method</th>
                  <th style="text-align:right;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">Amount</th>
                  <th style="text-align:center;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">Status</th>
                  <th style="text-align:left;padding:10px 14px;font-size:11px;color:var(--gray);font-weight:600;">ID</th>
                </tr>
              </thead>
              <tbody id="hist-tbody"></tbody>
            </table>
          </div>
          <div id="hist-empty" style="display:none;text-align:center;padding:48px;color:var(--gray);">
            <div style="font-size:32px;margin-bottom:10px;">📭</div>
            <div style="font-size:14px;font-weight:600;color:var(--white);">No transactions yet</div>
            <div style="font-size:12px;margin-top:4px;">Your deposits and withdrawals will appear here.</div>
          </div>
        </div>
      </div>

      <!-- ════════════════════ NOTIFICATIONS PAGE ════════════════════ -->
      <div class="page" id="page-notifications-page">
        <div class="inner-wrap" style="max-width:680px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:10px;">
            <div>
              <div class="inner-title" style="margin-bottom:2px;">🔔 Notifications</div>
              <div style="font-size:12px;color:var(--gray);">All your account alerts and updates.</div>
            </div>
            <button onclick="markAllNotifsRead()" style="background:var(--card);border:1px solid var(--border);color:var(--gray);padding:8px 14px;border-radius:8px;font-size:12px;cursor:pointer;font-family:inherit;">Mark all as read</button>
          </div>
          <div id="notif-page-list" style="display:flex;flex-direction:column;gap:8px;">
          </div>
        </div>
      </div>

      <!-- ════════════════════ BLOG / NEWS PAGE ════════════════════ -->
      <div class="page" id="page-blog">
        <div class="inner-wrap" style="max-width:800px;">
          <div class="inner-title">📰 Market News &amp; Updates</div>
          <div class="inner-sub" style="margin-bottom:24px;">Latest market insights, platform updates and trading tips from our analysts.</div>
          <div id="blog-list" style="display:flex;flex-direction:column;gap:16px;">
          </div>
        </div>
      </div>

    </div><!-- /content-area -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- NOTIFICATIONS PANEL -->
<div class="notif-overlay" id="notif-overlay" onclick="closeNotif()"></div>
<div class="notif-panel" id="notif-panel" style="display:none">
  <div class="notif-hdr">🔔 Notifications</div>
  <div id="notif-body"><div class="notif-empty">No notifications yet</div></div>
</div>

<!-- PROFILE DROPDOWN -->
<div class="profile-overlay" id="profile-overlay" onclick="closeProfile()"></div>
<div class="profile-panel" id="profile-panel" style="display:none">
  <!-- Header -->
  <div class="profile-head" style="display:flex;align-items:center;gap:12px;padding:16px;cursor:pointer;" onclick="switchPage('user-profile',null);closeProfile()">
    <div class="tb-avatar" style="width:44px;height:44px;font-size:14px;flex-shrink:0;" id="pd-avatar">SW</div>
    <div style="min-width:0;">
      <div class="profile-head-name" id="pd-name" style="font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Loading...</div>
      <div class="profile-head-email" id="pd-email" style="font-size:11px;color:var(--gray);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">--</div>
      <div style="display:inline-flex;align-items:center;gap:4px;background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.2);color:#e74c3c;font-size:9px;font-weight:700;padding:2px 7px;border-radius:4px;margin-top:3px;letter-spacing:0.5px;">NOT VERIFIED</div>
    </div>
  </div>

  <!-- Payments -->
  <div class="profile-item" onclick="switchPage('dashboard',null);setTimeout(openDepositModal,100);closeProfile()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div>
    <div><div class="pi-title">Payments</div><div class="pi-sub">Deposit and withdraw</div></div>
  </div>

  <div class="pd-section-label">Profile</div>

  <div class="profile-item" onclick="switchPage('personal-info',null);closeProfile()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
    <div><div class="pi-title">Personal Information</div><div class="pi-sub">Edit your profile details</div></div>
  </div>

  <div class="profile-item" onclick="switchPage('security',null);closeProfile()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
    <div><div class="pi-title">Security</div><div class="pi-sub">Password, email &amp; 2FA</div></div>
  </div>

  <div class="profile-item" onclick="switchPage('subscribe',null);closeProfile()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>
    <div><div class="pi-title">Upgrade Tier</div><div class="pi-sub">Increase account features</div></div>
  </div>

  <div class="profile-item" onclick="switchPage('settings',null);closeProfile()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div>
    <div><div class="pi-title">Settings</div><div class="pi-sub">Customize your experience</div></div>
  </div>

  <div style="height:1px;background:var(--border);margin:6px 0;"></div>
  <div class="profile-item danger" onclick="doLogout()">
    <div class="pi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
    <div><div class="pi-title" style="color:#e74c3c">Log Out</div></div>
  </div>
</div>

<!-- CHAT BUTTON -->
<div class="chat-btn">
  💬
  <div class="chat-notif">1</div>
</div>

<script>
const {createClient}=supabase;
const sb=createClient('https://tnvbiricxztlxppdqphh.supabase.co','sb_publishable_sbf6NMGko9Jtm9ySrjk4UA_iNCn-pnI');

// ── Global state vars ──
let user = null, wallet = null, bscMode = 'buy';
let allHistory = [], histTypeFilter = 'all', histStatusFilter = 'all', histPage = 1;
let allWLData = [], wlFilter = 'all', wlInterval = null;
let btcChange24h = 0;
let notifPageData = [];

/* ──────── INIT ──────── */
async function init(){
  document.getElementById('loading-screen').style.display='flex';
  document.querySelector('.app').style.opacity='0';

  // Retry getSession up to 30 times with 300ms gap = 9 seconds max
  let session=null;
  for(let i=0;i<30;i++){
    const {data}=await sb.auth.getSession();
    if(data?.session){session=data.session;break;}
    await new Promise(r=>setTimeout(r,300));
  }

  // If STILL no session, check if we just logged in via localStorage flag
  if(!session){
    const justLoggedIn=localStorage.getItem('sb_logged_in');
    if(justLoggedIn){
      // Wait a bit more and try one last time
      await new Promise(r=>setTimeout(r,2000));
      const {data}=await sb.auth.getSession();
      session=data?.session||null;
    }
  }

  // Clear the flag regardless
  localStorage.removeItem('sb_logged_in');

  if(!session){
    window.location.replace('login.html');
    return;
  }

  // ✅ Session confirmed — show dashboard
  user=session.user;
  document.getElementById('loading-screen').style.display='none';
  document.querySelector('.app').style.opacity='1';

  try{
    const [{data:profile},{data:wal}]=await Promise.all([
      sb.from('profiles').select('*').eq('id',user.id).single(),
      sb.from('wallets').select('*').eq('user_id',user.id).single()
    ]);
    wallet=wal;
    const name=profile?.full_name||user.email.split('@')[0]||'User';
    const initials=name.trim().split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2);
    document.getElementById('avatar-el').textContent=initials;
    document.getElementById('pd-name').textContent=name;
    document.getElementById('pd-email').textContent=user.email;
  setMobileUserInfo(user.email);
  setTimeout(()=>{populateProfilePage();loadSettings();updateSubscribePage();},500);
  }catch(e){
    const name=user.email.split('@')[0]||'User';
    document.getElementById('avatar-el').textContent=name.slice(0,2).toUpperCase();
    document.getElementById('pd-name').textContent=name;
    document.getElementById('pd-email').textContent=user.email;
  }

  loadWalletAddresses();
  refreshBalances();
  loadTrades();
  loadNotifs();
  fetchPrices();
  setInterval(fetchPrices,15000); // Every 15s for live BTC-linked balance
  setTimeout(()=>{
    const v=Math.floor(Math.random()*20)+2;
    document.getElementById('sig-pct-el').textContent=v+'%';
    document.getElementById('sig-fill-el').style.width=v+'%';
  },1200);

  // Watch for logout only
  sb.auth.onAuthStateChange((event)=>{
    if(event==='SIGNED_OUT') window.location.replace('login.html');
  });
}
function refreshBalances(){
  if(!wallet) return;
  const base=(+wallet.btc_balance||0)+(+wallet.stocks_balance||0)+(+wallet.forex_balance||0);
  // Apply live BTC market movement to balance
  const multiplier=1+(btcChange24h/100);
  const liveTotal=base*multiplier;
  const fmt='$'+liveTotal.toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});
  // Update balance display
  const balEl=document.getElementById('bal-display');
  if(balEl) balEl.textContent=fmt;
  const wdEl=document.getElementById('wd-avail-show');
  if(wdEl) wdEl.textContent=fmt;
  const tbEl=document.getElementById('trade-bal-show');
  if(tbEl) tbEl.textContent='$'+liveTotal.toLocaleString('en',{minimumFractionDigits:2});
  const bvEl=document.getElementById('btc-val-r');
  if(bvEl) bvEl.textContent='$'+liveTotal.toLocaleString('en',{minimumFractionDigits:2});
  const pvEl=document.getElementById('pa-btc-val');
  if(pvEl) pvEl.textContent='$'+liveTotal.toLocaleString('en',{minimumFractionDigits:2});
  // Update mini stat cards
  const stTotal=document.getElementById('stat-total');
  if(stTotal) stTotal.textContent='$'+liveTotal.toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});
  const stDep=document.getElementById('stat-deposited');
  if(stDep) stDep.textContent='$'+(+wallet.total_deposited||0).toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2});
  const stProfit=document.getElementById('stat-profit');
  if(stProfit){
    const profit=(+wallet.total_profit||0)+(liveTotal-base);
    stProfit.textContent=(profit>=0?'+':'')+profit.toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2,style:'currency',currency:'USD'});
    stProfit.className='bal-stat-val '+(profit>=0?'green':'');
    if(profit<0) stProfit.style.color='#e74c3c';
  }
  // Update badge with live BTC change
  const badge=document.getElementById('balance-badge-el');
  if(badge){
    const isUp=btcChange24h>=0;
    const chgStr=(isUp?'+':'')+btcChange24h.toFixed(2)+'%';
    badge.style.background=isUp?'#1a3d2b':'#3d1a1a';
    badge.style.color=isUp?'#2ecc71':'#e74c3c';
    badge.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="width:10px;height:10px"><polyline points="${isUp?'18 15 12 9 6 15':'6 9 12 15 18 9'}"/></svg>${chgStr} BTC`;
  }
}
async function fetchPrices(){
  try{
    const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true');
    const d=await r.json();
    if(d.bitcoin?.usd){
      lastBtcPrice=d.bitcoin.usd;
      btcChange24h=parseFloat(d.bitcoin.usd_24h_change||0);
      const el=document.getElementById('pa-btc-price');
      if(el) el.textContent='$'+d.bitcoin.usd.toLocaleString('en');
      // Refresh balance display with new market data
      refreshBalances();
    }
    if(d.ethereum?.usd){
      const el=document.getElementById('pa-eth-price');
      if(el) el.textContent='$'+d.ethereum.usd.toLocaleString('en');
    }
  }catch(e){}
}
function setBSC(mode){
  bscMode=mode;
  ['buy','sell','convert'].forEach(m=>{
    const el=document.getElementById('bsc-'+m);
    el.className='bsc-btn';
    if(m===mode) el.classList.add(mode==='sell'?'active-sell':'active-buy');
  });
  const btn=document.getElementById('trade-action-btn');
  btn.textContent=mode.charAt(0).toUpperCase()+mode.slice(1);
  btn.className='action-btn '+(mode==='sell'?'sell-mode':'buy');
}
function pickLev(el,val){
  document.querySelectorAll('.lev-chip').forEach(c=>c.classList.remove('picked'));
  el.classList.add('picked');
  document.getElementById('lev-inp').value=val;
}
function updateTradeAsset(){
  const type=document.getElementById('trade-type-sel').value;
  const map={crypto:'BTC',stocks:'AAPL',forex:'EUR',commodities:'GOLD'};
  const sym=map[type]||'BTC';
  document.getElementById('asset-badge').innerHTML=sym+' <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:9px;height:9px"><polyline points="6 9 12 15 18 9"/></svg>';
  document.getElementById('sl-badge').textContent=sym;
  document.getElementById('tp-badge').textContent=sym;
}
async function placeTrade(){
  const amt=parseFloat(document.getElementById('trade-amt-inp').value);
  if(!amt||amt<=0){alert('Please enter a valid amount.');return;}
  const total=(+wallet?.btc_balance||0)+(+wallet?.stocks_balance||0)+(+wallet?.forex_balance||0);
  if(amt>total){alert('Insufficient balance. Please deposit funds first.');return;}
  const sl=document.getElementById('sl-inp').value;
  const tp=document.getElementById('tp-inp').value;
  const lev=document.getElementById('lev-inp').value;
  const dur=document.getElementById('dur-sel').value;
  const type=document.getElementById('trade-type-sel').value;
  await sb.from('transactions').insert({
    user_id:user.id,type:bscMode,amount:amt,
    payment_method:type,status:'pending',
    proof_url:JSON.stringify({sl,tp,lev,dur})
  });
  alert('✅ Trade placed successfully!');
  document.getElementById('trade-amt-inp').value='';
  loadTrades();
}
function tradeTab(mode,el){
  tradesMode=mode;
  document.querySelectorAll('.trades-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  loadTrades();
}
async function loadWalletAddresses(){
  const {data}=await sb.from('wallet_addresses')
    .select('*').eq('is_active',true)
    .order('usage_count',{ascending:true});
  allWalletAddresses={};
  if(data){
    data.forEach(a=>{
      if(!allWalletAddresses[a.method]) allWalletAddresses[a.method]=[];
      allWalletAddresses[a.method].push(a);
    });
  }
}
function getNextAddress(method){
  const list=allWalletAddresses[method];
  if(!list||!list.length) return null;
  return list[0]; // already sorted by usage_count ASC — least used first
}
function openDepositModal(){
  loadWalletAddresses(); // refresh every time modal opens
  document.getElementById('deposit-modal').classList.add('open');
  document.getElementById('mod-method').value='';
  document.getElementById('mod-amount').value='';
  document.getElementById('mod-msg').className='modal-msg';
  document.getElementById('mod-msg').textContent='';
  document.getElementById('address-section').style.display='none';
  document.getElementById('file-name').textContent='No file chosen';
  document.getElementById('proof-file').value='';
  assignedAddress=null;
}
function closeDepositModal(){
  document.getElementById('deposit-modal').classList.remove('open');
  assignedAddress=null;
}
function onMethodChange(){
  const method=document.getElementById('mod-method').value;
  const addrSection=document.getElementById('address-section');
  const addrEl=document.getElementById('mod-address');
  const labelEl=document.getElementById('addr-label');
  assignedAddress=null;

  if(!method){addrSection.style.display='none';return;}

  const addr=getNextAddress(method);
  if(addr && !addr.address.startsWith('YOUR_')){
    addrEl.textContent=addr.address;
    if(labelEl) labelEl.textContent=addr.label?'('+addr.label+')':'';
    assignedAddress=addr;
    addrSection.style.display='block';
  } else {
    addrEl.innerHTML='<span class="no-addr">Address not configured yet. Contact support.</span>';
    if(labelEl) labelEl.textContent='';
    addrSection.style.display='block';
  }
  const btn=document.getElementById('copy-btn');
  btn.textContent='Copy';btn.className='copy-btn';
}
function copyAddress(){
  const addr=document.getElementById('mod-address').textContent;
  const copy=(t)=>{
    const el=document.createElement('textarea');
    el.value=t;document.body.appendChild(el);
    el.select();document.execCommand('copy');
    document.body.removeChild(el);
  };
  try{
    navigator.clipboard.writeText(addr).catch(()=>copy(addr));
  }catch(e){copy(addr);}
  const btn=document.getElementById('copy-btn');
  btn.textContent='Copied!';btn.className='copy-btn copied';
  setTimeout(()=>{btn.textContent='Copy';btn.className='copy-btn';},2000);
}
function onFileSelected(){
  const file=document.getElementById('proof-file').files[0];
  document.getElementById('file-name').textContent=file?file.name:'No file chosen';
}
async function submitDeposit(){
  const method=document.getElementById('mod-method').value;
  const amt=parseFloat(document.getElementById('mod-amount').value);
  const file=document.getElementById('proof-file').files[0];
  const msg=document.getElementById('mod-msg');
  const btn=document.getElementById('dep-submit-btn');

  msg.className='modal-msg';
  if(!method){msg.className='modal-msg err';msg.textContent='Please select a payment method.';return;}
  if(!amt||amt<=0){msg.className='modal-msg err';msg.textContent='Please enter a valid amount.';return;}
  if(!file){msg.className='modal-msg err';msg.textContent='Please upload your payment proof.';return;}

  btn.disabled=true;btn.textContent='Submitting...';

  try{
    // Upload proof file to storage
    let proofUrl=file.name;
    try{
      const ext=file.name.split('.').pop();
      const fname=user.id+'_'+Date.now()+'.'+ext;
      const {data:ud,error:ue}=await sb.storage.from('payment-proofs').upload(fname,file,{upsert:true});
      if(!ue&&ud) proofUrl=ud.path;
    }catch(e){}

    // Save transaction — store assigned address in admin_note for admin visibility
    const addrNote=assignedAddress?'Address: '+assignedAddress.address:'';
    const {error}=await sb.from('transactions').insert({
      user_id:user.id,
      type:'deposit',
      amount:amt,
      payment_method:method,
      proof_url:proofUrl,
      admin_note:addrNote,
      status:'pending'
    });
    if(error) throw error;

    // Increment usage_count on assigned address for rotation tracking
    if(assignedAddress){
      await sb.from('wallet_addresses').update({
        usage_count:(assignedAddress.usage_count||0)+1,
        last_used:new Date().toISOString()
      }).eq('id',assignedAddress.id);
    }

    msg.className='modal-msg ok';
    msg.innerHTML='<strong>✅ Deposit Submitted Successfully!</strong><br><span style="font-size:11px;line-height:1.6;display:block;margin-top:6px;">Your deposit is now under review. Our team will confirm it within <strong>24 - 48 hours</strong>. You will be notified once it has been approved and credited to your account.</span>';
    btn.textContent='Submitted!';
    setTimeout(()=>{closeDepositModal();btn.disabled=false;btn.textContent='Deposit';loadTrades();},5000);
  }catch(e){
    msg.className='modal-msg err';
    msg.textContent='Error: '+(e.message||'Something went wrong. Please try again.');
    btn.disabled=false;btn.textContent='Deposit';
  }
}
async function doDeposit(){openDepositModal();}
async function doWithdraw(){
  const amt=parseFloat(document.getElementById('wd-amt').value);
  const method=document.getElementById('wd-method').value;
  const acct=document.getElementById('wd-acct').value.trim();
  const msg=document.getElementById('wd-msg');
  const total=(+wallet?.btc_balance||0)+(+wallet?.stocks_balance||0)+(+wallet?.forex_balance||0);
  if(!amt||amt<=0)return showMsg(msg,'Please enter a valid amount.','err');
  if(amt>total)return showMsg(msg,'Insufficient balance.','err');
  if(!method)return showMsg(msg,'Please select a withdrawal method.','err');
  if(!acct)return showMsg(msg,'Please enter your account or wallet address.','err');
  const {error}=await sb.from('transactions').insert({user_id:user.id,type:'withdrawal',amount:amt,payment_method:method,proof_url:acct,status:'pending'});
  if(error)return showMsg(msg,'Error: '+error.message,'err');
  showMsg(msg,'✅ Withdrawal submitted! Processing within 24 hours.','ok');
  document.getElementById('wd-amt').value='';
  document.getElementById('wd-acct').value='';
  document.getElementById('wd-method').value='';
}
async function loadNotifs(){
  const {data}=await sb.from('notifications').select('*').eq('user_id',user.id).order('created_at',{ascending:false});
  const el=document.getElementById('notif-body');
  if(!data||!data.length){el.innerHTML='<div class="notif-empty">No notifications yet</div>';return;}
  el.innerHTML=data.map(n=>`<div class="notif-item${n.is_read?'':' unread'}"><h5>${n.title}</h5><p>${n.message}</p></div>`).join('');
  sb.from('notifications').update({is_read:true}).eq('user_id',user.id);
}
function switchPage(name,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  var pg = document.getElementById('page-'+name);
  if(!pg){ console.error('Page not found: page-'+name); return; }
  pg.classList.add('active');
  // Start/stop watchlist ticker
  if(name==='markets') startWatchlist(); else stopWatchlist();
  if(name==='subscribe') updateSubscribePage();
  if(name==='referrals') loadReferrals();
  if(name==='history') loadHistory();
  if(name==='notifications-page') loadNotifPage();
  if(name==='blog'){
    // loadBlog is synchronous - call immediately
    if(typeof loadBlog === 'function') loadBlog();
    else console.error('loadBlog not defined');
  }
  document.querySelectorAll('.sb-item').forEach(i=>i.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('page-title').textContent=name.charAt(0).toUpperCase()+name.slice(1);
  closeNotif();closeProfile();
}
function toggleNotif(){
  const p=document.getElementById('notif-panel');
  const o=document.getElementById('notif-overlay');
  const open=p.style.display==='block';
  p.style.display=open?'none':'block';
  o.classList.toggle('open',!open);
  document.getElementById('profile-panel').style.display='none';
  document.getElementById('profile-overlay').classList.remove('open');
}
function closeNotif(){
  document.getElementById('notif-panel').style.display='none';
  document.getElementById('notif-overlay').classList.remove('open');
}
function toggleProfile(){
  const p=document.getElementById('profile-panel');
  const o=document.getElementById('profile-overlay');
  const open=p.style.display==='block';
  p.style.display=open?'none':'block';
  o.classList.toggle('open',!open);
  document.getElementById('notif-panel').style.display='none';
  document.getElementById('notif-overlay').classList.remove('open');
}
function closeProfile(){
  document.getElementById('profile-panel').style.display='none';
  document.getElementById('profile-overlay').classList.remove('open');
}
function toggleMobileSidebar(){
  const sb=document.querySelector('.sidebar');
  sb.style.display=sb.style.display==='none'?'flex':'none';
}
function openMobileMenu(){
  document.getElementById('mob-drawer').classList.add('open');
  document.getElementById('mob-overlay').classList.add('open');
}
function closeMobileMenu(){
  document.getElementById('mob-drawer').classList.remove('open');
  document.getElementById('mob-overlay').classList.remove('open');
}
function mobileSwitchPage(page, el){
  // Update active state in mobile nav
  document.querySelectorAll('#mob-nav .sb-item').forEach(b=>b.classList.remove('active'));
  if(el) el.classList.add('active');
  // Also update desktop sidebar
  document.querySelectorAll('.sb-nav .sb-item').forEach(b=>b.classList.remove('active'));
  // Switch the page
  switchPage(page, el);
  closeMobileMenu();
}
function setMobileUserInfo(email){
  const el=document.getElementById('mob-user-email');
  if(el) el.textContent=email;
}
function openSettingsPanel(section){
  document.getElementById('settings-overlay').classList.add('open');
  document.getElementById('settings-panel').classList.add('open');
  // Populate user info
  if(user){
    const initials=(user.email||'SW').slice(0,2).toUpperCase();
    const nameEl=document.getElementById('sp-name');
    const emailEl=document.getElementById('sp-email');
    const avEl=document.getElementById('sp-avatar');
    if(nameEl) nameEl.textContent=user.user_metadata?.full_name||user.email||'User';
    if(emailEl) emailEl.textContent=user.email||'--';
    if(avEl) avEl.textContent=initials;
  }
  // Scroll to section if specified
  if(section){
    setTimeout(()=>{
      const el=document.getElementById('sp-'+section);
      if(el) el.scrollIntoView({behavior:'smooth',block:'center'});
    },300);
  }
}
function closeSettingsPanel(){
  document.getElementById('settings-overlay').classList.remove('open');
  document.getElementById('settings-panel').classList.remove('open');
}
function copyRefLink(){
  const el = document.getElementById('ref-link-input');
  if(!el) return;
  navigator.clipboard.writeText(el.value).then(()=>{
    const btn = el.nextElementSibling;
    if(btn){ const orig=btn.textContent; btn.textContent='✅ Copied!'; setTimeout(()=>btn.textContent=orig,2000); }
  }).catch(()=>{ el.select(); document.execCommand('copy'); });
}
function populateProfilePage(){
  if(!user || !wallet) return;
  const meta = user.user_metadata || {};
  const initials = (meta.full_name||user.email||'SW').slice(0,2).toUpperCase();
  
  // Big avatar
  const av = document.getElementById('prof-avatar-big');
  if(av) av.textContent = initials;
  const avEl = document.getElementById('avatar-el');
  if(avEl) avEl.textContent = initials;

  // Names
  ['pd-avatar','sp-avatar'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=initials;});
  ['pd-name','sp-name'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=meta.full_name||user.email||'User';});
  ['pd-email','sp-email'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=user.email||'--';});

  // Profile page fields
  const setEl=(id,val)=>{const el=document.getElementById(id);if(el)el.textContent=val||'—';};
  setEl('prof-name-big', meta.full_name||user.email);
  setEl('prof-email-big', user.email);
  setEl('pi-fullname', meta.full_name);
  setEl('pi-email2', user.email);
  setEl('pi-phone', meta.phone);
  setEl('pi-age', meta.age);
  setEl('pi-country', meta.country);
  setEl('pi-address', meta.address);
  setEl('pi-uid', user.id);
  setEl('pi-since', new Date(user.created_at).toLocaleDateString('en',{year:'numeric',month:'long',day:'numeric'}));

  // Tier
  const tier = wallet.tier || 'Starter';
  setEl('pi-tier', tier);
  const tierBadge = document.getElementById('prof-tier-badge');
  if(tierBadge) tierBadge.textContent = tier.toUpperCase() + ' TIER';

  // KYC / Verified status
  const isVerified = wallet.kyc_verified === true;
  const kycStatus = wallet.kyc_status || 'not_submitted';
  setEl('pi-kyc', isVerified ? '✅ Verified' : kycStatus==='pending' ? '⏳ Pending Review' : 'Not Verified');
  const kyc_el = document.getElementById('pi-kyc');
  if(kyc_el) kyc_el.style.color = isVerified ? 'var(--green)' : kycStatus==='pending' ? '#f59e0b' : '#e74c3c';

  // Verified badge on profile header
  const vbadge = document.getElementById('prof-verified-badge');
  if(vbadge){
    if(isVerified){ vbadge.textContent='✅ VERIFIED'; vbadge.style.background='rgba(16,185,129,0.1)'; vbadge.style.borderColor='rgba(16,185,129,0.25)'; vbadge.style.color='var(--green)'; }
    else if(kycStatus==='pending'){ vbadge.textContent='⏳ PENDING'; vbadge.style.background='rgba(245,158,11,0.1)'; vbadge.style.borderColor='rgba(245,158,11,0.25)'; vbadge.style.color='#f59e0b'; }
  }

  // Prefill personal info form
  const pf=(id,val)=>{const el=document.getElementById(id);if(el&&val)el.value=val;};
  pf('pi-edit-name', meta.full_name);
  pf('pi-edit-age', meta.age);
  pf('pi-edit-phone', meta.phone);
  pf('pi-edit-country', meta.country);
  pf('pi-edit-address', meta.address);

  // KYC status banner
  const banner = document.getElementById('kyc-status-banner');
  const kycForm = document.getElementById('kyc-form');
  if(banner){
    if(isVerified){ banner.style.display='block'; banner.style.background='rgba(16,185,129,0.1)'; banner.style.border='1px solid rgba(16,185,129,0.2)'; banner.style.color='var(--green)'; banner.textContent='✅ Your identity has been verified successfully.'; if(kycForm) kycForm.style.display='none'; }
    else if(kycStatus==='pending'){ banner.style.display='block'; banner.style.background='rgba(245,158,11,0.1)'; banner.style.border='1px solid rgba(245,158,11,0.2)'; banner.style.color='#f59e0b'; banner.textContent='⏳ Your documents are under review. We will notify you once verified.'; if(kycForm) kycForm.style.display='none'; }
  }
}
async function savePersonalInfo(){
  const msg = document.getElementById('pi-msg');
  const meta = {
    full_name: document.getElementById('pi-edit-name').value.trim(),
    age: document.getElementById('pi-edit-age').value,
    phone: document.getElementById('pi-edit-phone').value.trim(),
    country: document.getElementById('pi-edit-country').value,
    address: document.getElementById('pi-edit-address').value.trim()
  };
  msg.style.color='var(--gray)'; msg.textContent='Saving...';
  const {error} = await sb.auth.updateUser({data: meta});
  if(error){ msg.style.color='#e74c3c'; msg.textContent='Error: '+error.message; return; }
  // Update local user meta
  if(user) user.user_metadata = {...(user.user_metadata||{}), ...meta};
  populateProfilePage();
  msg.style.color='var(--green)'; msg.textContent='✅ Profile updated successfully!';
  setTimeout(()=>msg.textContent='',3000);
}
function onKycFileSelect(input){
  const fn = document.getElementById('kyc-file-name');
  if(fn && input.files[0]) fn.textContent = '📎 ' + input.files[0].name;
}
async function submitKYC(){
  const msg    = document.getElementById('kyc-msg');
  const idType = document.getElementById('kyc-id-type').value;
  const idNum  = document.getElementById('kyc-id-number').value.trim();
  const file   = document.getElementById('kyc-file').files[0];

  if(!idType){ msg.style.color='#e74c3c'; msg.textContent='Please select an ID type.'; return; }
  if(!idNum){  msg.style.color='#e74c3c'; msg.textContent='Please enter your ID number.'; return; }
  if(!file){   msg.style.color='#e74c3c'; msg.textContent='Please upload your ID document.'; return; }

  if(file.size > 5 * 1024 * 1024){
    msg.style.color='#e74c3c';
    msg.textContent='File too large. Please upload a file under 5MB.';
    return;
  }

  msg.style.color='var(--gray)'; msg.textContent='Processing document...';

  try {
    // Get any saved metadata (won't block submission if missing)
    const meta = user.user_metadata || {};

    // 1. Convert file to base64 — no storage bucket needed
    const b64 = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload  = () => resolve(reader.result);
      reader.onerror = () => reject(new Error('Could not read file. Please try a different file.'));
      reader.readAsDataURL(file);
    });

    msg.textContent = 'Saving your submission...';

    // 2. Save KYC data to wallets table only (safe — no extra columns needed on profiles)
    const {error: dbErr} = await sb.from('wallets').update({
      kyc_status:       'pending',
      kyc_id_type:      idType,
      kyc_id_number:    idNum,
      kyc_document_url: b64,
      kyc_submitted_at: new Date().toISOString(),
      kyc_full_name:    meta.full_name || '',
      kyc_phone:        meta.phone     || '',
      kyc_age:          meta.age       || '',
      kyc_country:      meta.country   || '',
      kyc_email:        user.email     || '',
    }).eq('user_id', user.id);

    if(dbErr) throw new Error(dbErr.message);

    // 3. Update local wallet state
    if(wallet) wallet.kyc_status = 'pending';

    // 4. Send notification to user (silently ignore errors)
    try {
      await sb.from('notifications').insert({
        user_id: user.id,
        title:   'KYC Submitted',
        message: 'Your identity documents have been received and are under review. We will notify you within 24-48 hours.',
        type:    'kyc',
        read:    false,
        is_read: false,
      });
    } catch(_){}

    // 5. Show success
    msg.style.color = 'var(--green)';
    msg.textContent = '✅ Submitted! Your ID is under review. We will notify you within 24–48 hours.';

    const form = document.getElementById('kyc-form');
    if(form) form.style.display = 'none';

    const banner = document.getElementById('kyc-status-banner');
    if(banner){
      banner.style.display    = 'block';
      banner.style.background = 'rgba(245,158,11,0.1)';
      banner.style.border     = '1px solid rgba(245,158,11,0.2)';
      banner.style.color      = '#f59e0b';
      banner.textContent      = '⏳ Your documents are under review. We will notify you once verified.';
    }

    // Refresh notification badge
    loadNotifBadge();

  } catch(e){
    msg.style.color = '#e74c3c';
    msg.textContent = 'Error: ' + (e.message || 'Something went wrong. Please try again.');
    console.error('KYC submit error:', e);
  }
}
function togglePw(id, btn){
  const el = document.getElementById(id);
  if(!el) return;
  el.type = el.type==='password' ? 'text' : 'password';
  btn.textContent = el.type==='password' ? '👁' : '🙈';
}
async function changePassword(){
  const msg = document.getElementById('sec-pw-msg');
  const cur = document.getElementById('sec-cur-pw').value;
  const nw = document.getElementById('sec-new-pw').value;
  const conf = document.getElementById('sec-conf-pw').value;
  if(!cur||!nw||!conf){ msg.style.color='#e74c3c'; msg.textContent='Please fill in all fields.'; return; }
  if(nw !== conf){ msg.style.color='#e74c3c'; msg.textContent='New passwords do not match.'; return; }
  if(nw.length < 8){ msg.style.color='#e74c3c'; msg.textContent='Password must be at least 8 characters.'; return; }
  msg.style.color='var(--gray)'; msg.textContent='Updating...';
  // Re-authenticate then update
  const {error: signErr} = await sb.auth.signInWithPassword({email: user.email, password: cur});
  if(signErr){ msg.style.color='#e74c3c'; msg.textContent='Current password is incorrect.'; return; }
  const {error} = await sb.auth.updateUser({password: nw});
  if(error){ msg.style.color='#e74c3c'; msg.textContent='Error: '+error.message; return; }
  msg.style.color='var(--green)'; msg.textContent='✅ Password updated successfully!';
  ['sec-cur-pw','sec-new-pw','sec-conf-pw'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
}
async function resetPasswordEmail(){
  const {error} = await sb.auth.resetPasswordForEmail(user.email);
  if(error) alert('Error: '+error.message);
  else alert('✅ Password reset email sent to '+user.email+'. Check your inbox.');
}
async function changeEmail(){
  const msg = document.getElementById('sec-email-msg');
  const pw = document.getElementById('sec-email-pw').value;
  const newEmail = document.getElementById('sec-new-email').value.trim();
  if(!pw||!newEmail){ msg.style.color='#e74c3c'; msg.textContent='Please fill in all fields.'; return; }
  msg.style.color='var(--gray)'; msg.textContent='Updating...';
  const {error: signErr} = await sb.auth.signInWithPassword({email: user.email, password: pw});
  if(signErr){ msg.style.color='#e74c3c'; msg.textContent='Current password is incorrect.'; return; }
  const {error} = await sb.auth.updateUser({email: newEmail});
  if(error){ msg.style.color='#e74c3c'; msg.textContent='Error: '+error.message; return; }
  msg.style.color='var(--green)'; msg.textContent='✅ Check your new email for a confirmation link.';
}
async function changePhone(){
  const msg = document.getElementById('sec-phone-msg');
  const pw = document.getElementById('sec-phone-pw').value;
  const phone = document.getElementById('sec-new-phone').value.trim();
  if(!pw||!phone){ msg.style.color='#e74c3c'; msg.textContent='Please fill in all fields.'; return; }
  msg.style.color='var(--gray)'; msg.textContent='Updating...';
  const {error: signErr} = await sb.auth.signInWithPassword({email: user.email, password: pw});
  if(signErr){ msg.style.color='#e74c3c'; msg.textContent='Current password is incorrect.'; return; }
  const {error} = await sb.auth.updateUser({data:{phone}});
  if(error){ msg.style.color='#e74c3c'; msg.textContent='Error: '+error.message; return; }
  if(user) user.user_metadata = {...(user.user_metadata||{}), phone};
  msg.style.color='var(--green)'; msg.textContent='✅ Phone number updated successfully!';
}
function toggle2FA(){
  const btn = document.getElementById('twofa-btn');
  const status = document.getElementById('twofa-status');
  const msg = document.getElementById('sec-2fa-msg');
  // Simulate toggle (real 2FA requires TOTP library)
  if(btn.textContent==='Enable 2FA'){
    btn.textContent='Disable 2FA'; btn.style.background='#e74c3c';
    if(status) status.textContent='Status: Enabled ✅';
    if(msg){ msg.style.color='var(--green)'; msg.textContent='2FA enabled. Use Google Authenticator or similar app.'; }
  } else {
    btn.textContent='Enable 2FA'; btn.style.background='var(--blue)';
    if(status) status.textContent='Status: Not enabled';
    if(msg){ msg.style.color='var(--gray)'; msg.textContent='2FA disabled.'; }
  }
}
function setTheme(theme, el){
  document.querySelectorAll('.theme-opt').forEach(o=>o.style.borderColor='var(--border)');
  if(el) el.style.borderColor='var(--blue)';
  const root = document.documentElement;
  const themes = {
    dark:    {bg:'#111111',sidebar:'#1a1a1a',card:'#1e1e1e'},
    midnight:{bg:'#050810',sidebar:'#080d18',card:'#0f1626'},
    dim:     {bg:'#1a1f2e',sidebar:'#1f2535',card:'#252d40'}
  };
  const t = themes[theme]||themes.dark;
  document.getElementById('app-wrap')||document.querySelector('.app');
  document.body.style.background = t.bg;
  localStorage.setItem('se-theme', theme);
}
function setAccent(color, el){
  document.querySelectorAll('.color-opt').forEach(o=>o.style.border='3px solid transparent');
  if(el) el.style.border='3px solid #fff';
  document.documentElement.style.setProperty('--blue', color);
  document.documentElement.style.setProperty('--green-btn', color);
  localStorage.setItem('se-accent', color);
}
function saveSetting(key, val){
  localStorage.setItem('se-'+key, val);
}
function toggleBalanceVisibility(show){
  const el = document.getElementById('bal-display');
  if(el) el.style.filter = show ? 'none' : 'blur(8px)';
  saveSetting('pref-showbal', show);
}
function loadSettings(){
  // Load accent
  const accent = localStorage.getItem('se-accent');
  if(accent){ document.documentElement.style.setProperty('--blue', accent); document.documentElement.style.setProperty('--green-btn', accent); }
  // Load balance visibility
  const showBal = localStorage.getItem('se-pref-showbal');
  if(showBal==='false'){ const el=document.getElementById('bal-display'); if(el) el.style.filter='blur(8px)'; const cb=document.getElementById('pref-showbal'); if(cb) cb.checked=false; }
}
async function loadWatchlist(){
  // Fetch crypto prices
  const ids = WL_ASSETS.filter(a=>!a.static).map(a=>a.id).join(',');
  try {
    const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids='+ids+'&vs_currencies=usd&include_24hr_change=true');
    const d = await r.json();
    WL_ASSETS.filter(a=>!a.static).forEach(a=>{
      if(d[a.id]) wlPrices[a.id] = {price: d[a.id].usd, chg: d[a.id].usd_24h_change||0};
    });
  } catch(e){}
  // Add static prices with tiny random jitter
  WL_ASSETS.filter(a=>a.static).forEach(a=>{
    const base = STATIC_PRICES[a.id];
    if(base) {
      const jitter = (Math.random()-0.5)*0.002;
      wlPrices[a.id] = {price: base.price*(1+jitter), chg: base.chg + (Math.random()-0.5)*0.1};
    }
  });
  renderWatchlist();
}
function setWLFilter(f, btn){
  wlFilter = f;
  document.querySelectorAll('.wl-filter-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
  renderWatchlist();
}
function renderWatchlist(){
  const grid = document.getElementById('wl-grid');
  if(!grid) return;
  const assets = wlFilter==='all' ? WL_ASSETS : WL_ASSETS.filter(a=>a.cat===wlFilter);
  grid.innerHTML = assets.map(a=>{
    const p = wlPrices[a.id];
    if(!p) return '';
    const isUp = p.chg >= 0;
    const priceStr = a.sym.includes('/') && p.price < 100
      ? p.price.toFixed(4)
      : p.price > 100 ? '$'+p.price.toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2})
      : '$'+p.price.toFixed(4);
    const chgStr = (isUp?'+':'')+p.chg.toFixed(2)+'%';
    const barPct = Math.min(100, Math.abs(p.chg)*10);
    return `<div class="price-card">
      <div class="price-card-top">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="price-card-ico" style="background:${a.bg}22;color:${a.color};">${a.icon}</div>
          <div><div class="price-card-sym">${a.sym}</div><div class="price-card-name">${a.name}</div></div>
        </div>
        <div class="price-card-chg ${isUp?'up':'dn'}">${isUp?'▲':'▼'} ${chgStr}</div>
      </div>
      <div class="price-card-price" style="color:${isUp?'var(--green)':'#ef4444'}">${priceStr}</div>
      <div class="price-card-bar"><div class="price-card-fill" style="width:${barPct}%;background:${isUp?'var(--green)':'#ef4444'};"></div></div>
    </div>`;
  }).join('');
}
function startWatchlist(){
  loadWatchlist();
  if(wlInterval) clearInterval(wlInterval);
  wlInterval = setInterval(loadWatchlist, 10000);
}
function stopWatchlist(){
  if(wlInterval){ clearInterval(wlInterval); wlInterval=null; }
}
function showWalletConnect(name){
  document.getElementById('wcm-name').textContent = name;
  document.getElementById('wcm-icon').textContent = walletIcons[name]||'🔗';
  document.getElementById('wallet-connect-modal').style.display = 'flex';
  // Simulate connection attempt then close
  setTimeout(()=>{
    document.getElementById('wallet-connect-modal').style.display = 'none';
    alert(name+' connection coming soon! This feature is under development.');
  }, 3000);
}
function selectPlan(planName, range){
  selectedPlan = planName;
  // Open deposit modal with plan context note
  openDepositModal();
  // Set a note in the modal about the plan
  setTimeout(()=>{
    const noteEl = document.getElementById('deposit-plan-note');
    if(noteEl){
      noteEl.style.display = 'block';
      noteEl.innerHTML = '📋 Subscribing to <strong>' + planName + ' Plan</strong> &mdash; Deposit range: ' + range;
    }
  }, 100);
}
function updateSubscribePage(){
  const tier = (wallet && wallet.tier) ? wallet.tier : 'Starter';
  const tierLower = tier.toLowerCase();
  const tierOrder = {starter:0, growth:1, elite:2};
  const currentLevel = tierOrder[tierLower] || 0;

  // ── Hide promo banner if user has upgraded past Starter ──
  const promoBanner = document.getElementById('promo-banner');
  if(promoBanner){
    promoBanner.style.display = currentLevel > 0 ? 'none' : '';
  }

  // ── Update current plan banner at top of subscribe page ──
  const banner = document.getElementById('current-plan-banner');
  const bannerName = document.getElementById('banner-tier-name');
  const bannerBadge = document.getElementById('banner-tier-badge');
  if(banner){
    banner.style.display = 'flex';
    if(bannerName) bannerName.textContent = tier + ' Plan';
    if(bannerBadge){
      bannerBadge.textContent = tier.toUpperCase() + ' TIER';
      const colors = {starter:'rgba(59,130,246,0.15)', growth:'rgba(16,185,129,0.15)', elite:'rgba(245,158,11,0.15)'};
      const textColors = {starter:'var(--blue)', growth:'var(--green)', elite:'#f59e0b'};
      bannerBadge.style.background = colors[tierLower] || colors.starter;
      bannerBadge.style.color = textColors[tierLower] || textColors.starter;
      bannerBadge.style.borderColor = (textColors[tierLower]||'var(--blue)').replace('var','').replace('(--blue)','rgba(59,130,246,0.3)');
    }
  }

  // ── Reset all plan cards to default state first ──
  const allTiers = ['starter', 'growth', 'elite'];
  const planBtnDefaults = {
    starter: ["selectPlan('Starter','$100 - $4,999')", 'Get Started'],
    growth:  ["selectPlan('Growth','$5,000 - $49,999')", 'Get Started'],
    elite:   ["selectPlan('Elite','$50,000+')", 'Get Started']
  };

  allTiers.forEach(t => {
    const card = document.getElementById('plan-card-' + t);
    const btn  = document.getElementById('plan-btn-' + t);
    if(card){
      card.classList.remove('current-plan', 'past-plan');
      card.querySelectorAll('.current-plan-chip, .past-plan-chip').forEach(el => el.remove());
      card.style.pointerEvents = '';
    }
    if(btn){
      btn.classList.remove('current-btn', 'past-btn');
      btn.setAttribute('onclick', planBtnDefaults[t][0]);
      btn.textContent = planBtnDefaults[t][1];
      btn.disabled = false;
    }
  });

  // ── Mark past tiers (tiers BELOW current) as inactive ──
  allTiers.forEach(t => {
    const level = tierOrder[t];
    const card  = document.getElementById('plan-card-' + t);
    const btn   = document.getElementById('plan-btn-' + t);

    if(level < currentLevel){
      // PAST TIER — greyed out, locked, crossed out
      if(card){
        card.classList.add('past-plan');
        card.style.pointerEvents = 'none';
        const chip = document.createElement('div');
        chip.className = 'past-plan-chip';
        chip.textContent = '✓ Completed';
        card.insertBefore(chip, card.firstChild);
      }
      if(btn){
        btn.classList.add('past-btn');
        btn.textContent = 'Plan Completed';
        btn.setAttribute('onclick', '');
        btn.disabled = true;
      }
    } else if(level === currentLevel){
      // CURRENT TIER — highlighted as active
      if(card){
        card.classList.add('current-plan');
        const chip = document.createElement('div');
        chip.className = 'current-plan-chip';
        chip.textContent = '✓ Your Current Plan';
        card.insertBefore(chip, card.firstChild);
      }
      if(btn){
        btn.classList.add('current-btn');
        btn.textContent = 'Current Plan';
        btn.setAttribute('onclick', '');
        btn.disabled = true;
      }
    }
    // HIGHER TIERS — stay as "Get Started" (default, already reset above)
  });
}
async function loadHistory(){
  const tbody = document.getElementById('hist-tbody');
  if(tbody) tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:32px;color:var(--gray);">Loading...</td></tr>';
  const {data} = await sb.from('transactions').select('*').eq('user_id',user.id).order('created_at',{ascending:false});
  allHistory = data || [];
  updateHistStats();
  renderHistory();
}
function setHistFilter(f,btn){
  histTypeFilter=f;
  document.querySelectorAll('.hf-type').forEach(b=>b.classList.remove('active-hf'));
  if(btn) btn.classList.add('active-hf');
  renderHistory();
}
function setHistStatus(f,btn){
  histStatusFilter=f;
  document.querySelectorAll('.hf-status').forEach(b=>b.classList.remove('active-hf'));
  if(btn) btn.classList.add('active-hf');
  renderHistory();
}
function renderHistory(){
  let data = allHistory;
  if(histTypeFilter !== 'all') data = data.filter(t=>t.type===histTypeFilter);
  if(histStatusFilter !== 'all') data = data.filter(t=>t.status===histStatusFilter);
  const tbody = document.getElementById('hist-tbody');
  const empty = document.getElementById('hist-empty');
  if(!data.length){
    if(tbody) tbody.innerHTML='';
    if(empty) empty.style.display='block';
    return;
  }
  if(empty) empty.style.display='none';
  const typeIcon={deposit:'📥',withdrawal:'📤',profit:'💰'};
  const typeColor={deposit:'var(--green)',withdrawal:'#ef4444',profit:'#f59e0b'};
  if(tbody) tbody.innerHTML = data.map(t=>{
    const badge = t.status==='approved'?'hb-approved':t.status==='pending'?'hb-pending':'hb-rejected';
    const amtColor = t.type==='withdrawal'?'#ef4444':'var(--green)';
    const amtSign = t.type==='withdrawal'?'-':'+';
    return `<tr class="hist-row">
      <td style="color:var(--gray)">${new Date(t.created_at).toLocaleDateString('en',{day:'2-digit',month:'short',year:'numeric'})}</td>
      <td><span style="color:${typeColor[t.type]||'var(--white)'};font-weight:600;">${typeIcon[t.type]||'💳'} ${(t.type||'').charAt(0).toUpperCase()+(t.type||'').slice(1)}</span></td>
      <td style="color:var(--gray)">${t.payment_method||'--'}</td>
      <td style="text-align:right;font-weight:700;color:${amtColor}">${amtSign}$${parseFloat(t.amount||0).toLocaleString('en',{minimumFractionDigits:2})}</td>
      <td style="text-align:center"><span class="hist-badge ${badge}">${(t.status||'').charAt(0).toUpperCase()+(t.status||'').slice(1)}</span></td>
      <td style="color:var(--gray);font-family:monospace;font-size:10px">${(t.id||'').slice(0,12).toUpperCase()}</td>
    </tr>`;
  }).join('');
}
function loadMoreHistory(){
  histPage++;
  renderHistory();
}
function exportHistory(){
  const data = allHistory;
  if(!data.length){ alert('No transactions to export.'); return; }
  const headers = ['Date','Type','Amount','Method','Status','ID'];
  const rows = data.map(t => [
    new Date(t.created_at).toLocaleString(),
    t.type, t.amount, t.payment_method||'', t.status, t.id
  ]);
  const csv = [headers, ...rows].map(r => r.map(v => '"'+(v||'').toString().replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = 'swiftexpress-history.csv'; a.click();
  URL.revokeObjectURL(url);
}
async function loadNotifPage(){
  const list = document.getElementById('notif-page-list');
  if(!list) return;
  list.innerHTML = '<div style="text-align:center;padding:40px;color:var(--gray);">Loading...</div>';
  try {
    const {data, error} = await sb.from('notifications')
      .select('*').eq('user_id', user.id)
      .order('created_at', {ascending:false});
    if(error) throw error;
    if(!data || !data.length){
      list.innerHTML = '<div style="text-align:center;padding:48px;"><div style="font-size:40px;margin-bottom:12px;">🔔</div><div style="font-size:14px;font-weight:600;color:var(--white);">No notifications yet</div><div style="font-size:12px;color:var(--gray);margin-top:6px;">Account alerts for deposits, withdrawals and KYC updates will show here.</div></div>';
      return;
    }
    const icons={deposit:'💰',withdrawal:'💸',profit:'📈',kyc:'🪪',security:'🔒',welcome:'👋',info:'ℹ️',success:'✅',warning:'⚠️',promo:'🎁'};
    list.innerHTML = data.map(n=>{
      const isUnread = !n.read;
      const icon = icons[n.type] || '🔔';
      const time = getTimeAgo(n.created_at);
      return '<div class="notif-page-item'+(isUnread?' unread':'')+'">'+
        (isUnread?'<div class="notif-page-dot"></div>':'<div style="width:8px;flex-shrink:0;"></div>')+
        '<div style="width:36px;height:36px;border-radius:50%;background:rgba(59,130,246,0.12);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;">'+icon+'</div>'+
        '<div style="flex:1;min-width:0;">'+
          '<div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;flex-wrap:wrap;">'+
            '<div style="font-size:13px;font-weight:'+(isUnread?'700':'500')+';color:var(--white);">'+(n.title||'Notification')+'</div>'+
            '<div style="font-size:10px;color:var(--gray);white-space:nowrap;">'+time+'</div>'+
          '</div>'+
          '<div style="font-size:12px;color:var(--gray);margin-top:3px;line-height:1.5;">'+(n.message||'')+'</div>'+
        '</div>'+
      '</div>';
    }).join('');
    // Mark all as read
    sb.from('notifications').update({read:true}).eq('user_id',user.id).eq('read',false).then(()=>loadNotifBadge());
  } catch(e) {
    list.innerHTML = '<div style="text-align:center;padding:32px;color:var(--gray);">Could not load notifications. Please try again.</div>';
  }
}

async function markAllNotifsRead(){
  await sb.from('notifications').update({read:true}).eq('user_id',user.id);
  loadNotifPage();
  loadNotifBadge();
}

async function loadReferrals(){
  if(!user) return;

  // Set referral link
  const refCode = user.id.slice(0,8);
  const refLink = 'https://swiftexpress-qzgn.vercel.app/register.html?ref=' + refCode;
  const inp = document.getElementById('ref-link-input');
  if(inp) inp.value = refLink;

  const setV = (id, v) => { const el = document.getElementById(id); if(el) el.textContent = v; };

  // Query users who signed up with this referral code
  const {data: refs, error} = await sb.from('profiles')
    .select('id, full_name, email, created_at')
    .eq('referred_by', refCode);

  const list = document.getElementById('ref-list');
  const items = refs || [];

  setV('ref-total-count', items.length);

  // Count how many have deposited
  let activeNum = 0, totalEarned = 0;
  if(items.length > 0){
    const ids = items.map(r => r.id);
    const {data: txs} = await sb.from('transactions')
      .select('user_id')
      .in('user_id', ids)
      .eq('type','deposit')
      .eq('status','approved');
    const deposited = new Set((txs||[]).map(t => t.user_id));
    activeNum = deposited.size;
    totalEarned = activeNum * 10;
  }

  setV('ref-active-count', activeNum);
  setV('ref-earned', '$' + totalEarned.toLocaleString());

  if(!list) return;
  if(!items.length){
    list.innerHTML = '<div style="text-align:center;padding:28px;color:var(--gray);font-size:13px;">No referrals yet. Share your link above to get started!</div>';
    return;
  }

  list.innerHTML = items.map(r => {
    const initials = (r.full_name || r.email || '?').slice(0,2).toUpperCase();
    const joined   = new Date(r.created_at).toLocaleDateString('en',{month:'short',day:'numeric',year:'numeric'});
    return `<div class="ref-item">
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#06b6d4);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;color:#fff;">${initials}</div>
        <div>
          <div style="font-size:13px;font-weight:600;">${r.full_name || 'Anonymous'}</div>
          <div style="font-size:11px;color:var(--gray);">${r.email || '--'}</div>
        </div>
      </div>
      <div style="text-align:right;">
        <div style="font-size:11px;color:var(--gray);">Joined ${joined}</div>
      </div>
    </div>`;
  }).join('');
}

function shareRefLink(platform){
  const link = document.getElementById('ref-link-input')?.value || '';
  const msg = encodeURIComponent('Join SwiftExpress and start investing! Use my referral link: ' + link);
  const urls = {
    whatsapp: 'https://wa.me/?text=' + msg,
    twitter:  'https://twitter.com/intent/tweet?text=' + msg,
    telegram: 'https://t.me/share/url?url=' + encodeURIComponent(link) + '&text=' + encodeURIComponent('Join SwiftExpress and start investing!'),
    email:    'mailto:?subject=Join SwiftExpress&body=' + msg
  };
  if(urls[platform]) window.open(urls[platform], '_blank');
}
const BLOG_POSTS = [
  {id:1,tag:'Market Update',tagColor:'rgba(59,130,246,0.15)',tagText:'#3b82f6',
   title:'Bitcoin surges past $95,000 — What this means for investors',
   excerpt:'Bitcoin has broken through a key resistance level, driven by institutional demand and ETF inflows. Analysts predict continued momentum through Q2.',
   date:'Feb 20, 2026',author:'SwiftExpress Analysts',readTime:'3 min read',
   content:'The recent surge in Bitcoin prices has been attributed to a combination of institutional buying, ETF inflows, and macroeconomic tailwinds. Several major corporations have announced Bitcoin treasury allocations, adding further demand pressure. Our analysts believe the current momentum is supported by strong on-chain fundamentals, with long-term holder supply at historic highs. For SwiftExpress investors, this presents an opportunity to review your allocation strategy. We recommend maintaining diversification across crypto and forex positions to manage volatility.'},
  {id:2,tag:'Platform Update',tagColor:'rgba(16,185,129,0.15)',tagText:'#10b981',
   title:'SwiftExpress now supports 11 external wallets including Phantom and Exodus',
   excerpt:'We have expanded our Connect Wallet feature to support 11 of the most popular crypto wallets, making it easier to link your existing holdings.',
   date:'Feb 18, 2026',author:'SwiftExpress Team',readTime:'2 min read',
   content:'We are excited to announce that the Connect Wallet feature on SwiftExpress now supports 11 external wallets. New additions include Phantom (Solana), Exodus, Ledger, Trezor, Rainbow, OKX Wallet and Bybit Wallet, joining existing support for MetaMask, WalletConnect, Coinbase Wallet and Trust Wallet. Full wallet integration for fund transfers is coming in the next platform update.'},
  {id:3,tag:'Trading Tips',tagColor:'rgba(245,158,11,0.15)',tagText:'#f59e0b',
   title:'5 risk management strategies every investor should know',
   excerpt:'Managing risk is the cornerstone of long-term investment success. Here are five proven strategies our top traders use to protect and grow capital.',
   date:'Feb 15, 2026',author:'SwiftExpress Analysts',readTime:'5 min read',
   content:'1. Position Sizing — Never risk more than 2% of your total capital on a single trade. 2. Stop-Loss Orders — Always set a stop-loss before entering any trade. Our signals page provides recommended stop levels. 3. Diversification — Spread investments across crypto, stocks, and forex to reduce correlation risk. 4. Take Profits Systematically — Take partial profits at key levels and let the remainder run. 5. Keep a Trading Journal — Document every trade with entry, exit, rationale and outcome.'},
  {id:4,tag:'Forex',tagColor:'rgba(139,92,246,0.15)',tagText:'#8b5cf6',
   title:'EUR/USD hits 3-month high amid ECB rate decision uncertainty',
   excerpt:'The Euro strengthened against the Dollar following mixed signals from European Central Bank officials regarding the pace of future rate cuts.',
   date:'Feb 12, 2026',author:'SwiftExpress Analysts',readTime:'3 min read',
   content:'EUR/USD climbed to its highest level in three months as market participants reassessed ECB rate cut expectations. ECB officials have been divided on the pace of easing, with some members advocating patience given persistent services inflation. For forex traders on SwiftExpress, the current environment favors range-trading strategies with tighter stops. Check the Signals page for the latest entries.'},
  {id:5,tag:'Education',tagColor:'rgba(239,68,68,0.15)',tagText:'#ef4444',
   title:'Understanding KYC verification — why it protects you',
   excerpt:'KYC (Know Your Customer) verification is not just a regulatory requirement — it is a critical layer of security that protects your funds and identity.',
   date:'Feb 10, 2026',author:'SwiftExpress Compliance',readTime:'4 min read',
   content:'KYC verification serves multiple important purposes. First, it prevents fraud by ensuring only real, verified individuals can access and withdraw funds. Second, it protects you as a user against unauthorized account access. Third, it ensures regulatory compliance which protects the platform and all users. At SwiftExpress, your KYC documents are reviewed by our compliance team within 24-48 hours and stored securely.'}
];

function loadBlog(){
  var list = document.getElementById('blog-list');
  if(!list){ console.error('blog-list not found'); return; }
  var posts = typeof BLOG_POSTS !== 'undefined' ? BLOG_POSTS : [];
  if(!posts.length){ list.innerHTML = '<p style="color:var(--gray);padding:20px;">No posts available.</p>'; return; }
  var html = '';
  for(var i=0;i<posts.length;i++){
    var p = posts[i];
    html += '<div class="blog-card" onclick="toggleBlog('+p.id+')">';
    html += '<div class="blog-tag" style="background:'+p.tagColor+';color:'+p.tagText+';">'+p.tag+'</div>';
    html += '<div class="blog-title">'+p.title+'</div>';
    html += '<div class="blog-excerpt">'+p.excerpt+'</div>';
    html += '<div class="blog-meta"><span>✍️ '+p.author+'</span><span style="margin-left:8px;">📅 '+p.date+'</span><span style="margin-left:auto;color:var(--blue);font-weight:600;" id="blog-toggle-'+p.id+'">Read more ›</span></div>';
    html += '<div class="blog-expanded" id="blog-exp-'+p.id+'" style="display:none;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);font-size:13px;color:var(--gray);line-height:1.7;">'+p.content+'</div>';
    html += '</div>';
  }
  list.innerHTML = html;
}
function toggleBlog(id){
  const exp = document.getElementById('blog-exp-'+id);
  const tog = document.getElementById('blog-toggle-'+id);
  if(!exp) return;
  const isOpen = exp.style.display === 'block';
  exp.style.display = isOpen ? 'none' : 'block';
  if(tog) tog.textContent = isOpen ? 'Read more ›' : 'Read less ‹';
}
function updateHistStats(){
  const deps = allHistory.filter(t=>t.type==='deposit'&&t.status==='approved');
  const wds  = allHistory.filter(t=>t.type==='withdrawal'&&t.status==='approved');
  const pend = allHistory.filter(t=>t.status==='pending');
  const setEl=(id,v)=>{const el=document.getElementById(id);if(el)el.textContent=v;};
  setEl('hist-total-dep','$'+deps.reduce((s,t)=>s+parseFloat(t.amount||0),0).toLocaleString('en',{minimumFractionDigits:2}));
  setEl('hist-total-wd','$'+wds.reduce((s,t)=>s+parseFloat(t.amount||0),0).toLocaleString('en',{minimumFractionDigits:2}));
  setEl('hist-total-profit', '$'+deps.reduce((s,t)=>s+parseFloat(t.amount||0)*0.05,0).toLocaleString('en',{minimumFractionDigits:2}));
}
function downloadStatement(){
  if(!allHistory.length){alert('No transactions to export.');return;}
  const rows=[['Date','Type','Method','Amount','Status','Reference ID']];
  allHistory.forEach(t=>{
    rows.push([
      new Date(t.created_at).toLocaleDateString(),
      t.type||'',
      t.payment_method||'',
      '$'+parseFloat(t.amount||0).toFixed(2),
      t.status||'',
      (t.id||'').toUpperCase()
    ]);
  });
  const csv = rows.map(r=>r.map(v=>'"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'SwiftExpress_Statement_'+new Date().toISOString().slice(0,10)+'.csv';
  a.click();
}
async function markAllRead(){
  await sb.from('notifications').update({is_read:true}).eq('user_id',user.id);
  loadNotifPage();
  loadNotifs();
}
function getTimeAgo(dateStr){
  const diff = Date.now() - new Date(dateStr).getTime();
  const mins = Math.floor(diff/60000);
  const hrs  = Math.floor(diff/3600000);
  const days = Math.floor(diff/86400000);
  if(mins<1) return 'Just now';
  if(mins<60) return mins+'m ago';
  if(hrs<24) return hrs+'h ago';
  if(days<7) return days+'d ago';
  return new Date(dateStr).toLocaleDateString('en',{day:'2-digit',month:'short',year:'numeric'});
}
function shareRef(platform){
  const inp = document.getElementById('ref-link-input');
  const link = inp ? inp.value : '';
  const text = 'Join SwiftExpress and start investing! Use my referral link: ';
  if(platform==='whatsapp') window.open('https://wa.me/?text='+encodeURIComponent(text+link),'_blank');
  else if(platform==='twitter') window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(text+link),'_blank');
  else if(platform==='telegram') window.open('https://t.me/share/url?url='+encodeURIComponent(link)+'&text='+encodeURIComponent(text),'_blank');
  else { navigator.clipboard.writeText(link).catch(()=>{}); alert('Referral link copied!'); }
}
function doLogout(){sb.auth.signOut().then(()=>{window.location.href='login.html';});}
function showMsg(el,txt,type){el.textContent=txt;el.className='msg-box '+type+' show';}
function toggleBalMenu(){}

init();</script>

<!-- ══════════════ DEPOSIT MODAL ══════════════ -->
<div class="modal-overlay" id="deposit-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeDepositModal()">✕</button>
    <div class="modal-title">Deposit</div>
    <div class="modal-sub">To make a deposit, choose your preferred method, enter an amount and upload a corresponding payment proof.</div>

    <label class="modal-label">Method</label>
    <select class="modal-select" id="mod-method" onchange="onMethodChange()">
      <option value="">Select method...</option>
      <option value="Bitcoin">Bitcoin</option>
      <option value="Ethereum">Ethereum</option>
      <option value="USDT (TRC20)">USDT (TRC20)</option>
      <option value="USDT (ERC20)">USDT (ERC20)</option>
      <option value="Bank Transfer">Bank Transfer</option>
    </select>

    <div id="address-section" style="display:none;">
      <label class="modal-label">Address</label>
      <div class="address-box">
        <div class="address-text" id="mod-address">--</div>
        <button class="copy-btn" id="copy-btn" onclick="copyAddress()">Copy</button>
      </div>
    </div>

    <label class="modal-label">Amount (USD)</label>
    <input class="modal-input" type="number" id="mod-amount" placeholder="0.00"/>

    <label class="modal-label" style="margin-bottom:6px;">Payment Proof</label>
    <div class="upload-area" onclick="document.getElementById('proof-file').click()">
      <input type="file" id="proof-file" accept="image/*,.pdf" onchange="onFileSelected()"/>
      <label class="upload-label">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Click here to upload payment proof
      </label>
      <div class="upload-name" id="file-name">No file chosen</div>
    </div>

    <button class="modal-dep-btn" id="dep-submit-btn" onclick="submitDeposit()">Deposit</button>
    <div class="modal-msg" id="mod-msg" style="margin-bottom:0;"></div>
  </div>
</div>


<!-- ══════════════ SETTINGS PANEL ══════════════ -->
<div class="settings-overlay" id="settings-overlay" onclick="closeSettingsPanel()"></div>
<div class="settings-panel" id="settings-panel">
  <div class="settings-header">
    <span>Settings</span>
    <button class="settings-close" onclick="closeSettingsPanel()">✕</button>
  </div>

  <!-- User info -->
  <div class="settings-user">
    <div class="settings-user-avatar" id="sp-avatar">SW</div>
    <div>
      <div class="settings-user-name" id="sp-name">Loading...</div>
      <div class="settings-user-email" id="sp-email">--</div>
      <div class="settings-not-verified">● Not Verified</div>
    </div>
  </div>

  <!-- Payments -->
  <div class="settings-item" onclick="closeSettingsPanel();switchPage('dashboard',null);setTimeout(openDepositModal,100)">
    <div class="settings-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="17" height="17"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></div>
    <div><div class="settings-item-title">Payments</div><div class="settings-item-sub">Deposit and withdraw</div></div>
  </div>

  <div class="settings-section-label">Profile</div>

  <div class="settings-item" id="sp-verification">
    <div class="settings-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="17" height="17"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
    <div><div class="settings-item-title">Verification</div><div class="settings-item-sub">Verification and confirmation of identity</div></div>
  </div>

  <div class="settings-item" id="sp-personal">
    <div class="settings-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="17" height="17"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
    <div><div class="settings-item-title">Personal</div><div class="settings-item-sub">Your personal information</div></div>
  </div>

  <div class="settings-item" id="sp-security">
    <div class="settings-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="17" height="17"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
    <div><div class="settings-item-title">Security</div><div class="settings-item-sub">Email and password</div></div>
  </div>

  <div class="settings-item" onclick="closeSettingsPanel();switchPage('subscribe',null)">
    <div class="settings-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="17" height="17"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>
    <div><div class="settings-item-title">Upgrade Tier</div><div class="settings-item-sub">Increase account features</div></div>
  </div>
</div>

</body>
</html>
